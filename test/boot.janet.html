<html>
<head>
<link rel="stylesheet" href="style.css" />
</head>
<body>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2023 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2023 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ebdbb2 }
body { background: #282828; color: #dddddd }
body .c { color: #928374; font-style: italic } /* Comment */
body .err { color: #282828; background-color: #fb4934 } /* Error */
body .esc { color: #dddddd } /* Escape */
body .g { color: #dddddd } /* Generic */
body .k { color: #fb4934 } /* Keyword */
body .l { color: #dddddd } /* Literal */
body .n { color: #dddddd } /* Name */
body .o { color: #dddddd } /* Operator */
body .x { color: #dddddd } /* Other */
body .p { color: #dddddd } /* Punctuation */
body .ch { color: #928374; font-style: italic } /* Comment.Hashbang */
body .cm { color: #928374; font-style: italic } /* Comment.Multiline */
body .c-PreProc { color: #8ec07c; font-style: italic } /* Comment.PreProc */
body .cp { color: #928374; font-style: italic } /* Comment.Preproc */
body .cpf { color: #928374; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #928374; font-style: italic } /* Comment.Single */
body .cs { color: #ebdbb2; font-weight: bold; font-style: italic } /* Comment.Special */
body .gd { color: #282828; background-color: #fb4934 } /* Generic.Deleted */
body .ge { color: #dddddd; font-style: italic } /* Generic.Emph */
body .ges { color: #dddddd; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #fb4934 } /* Generic.Error */
body .gh { color: #ebdbb2; font-weight: bold } /* Generic.Heading */
body .gi { color: #282828; background-color: #b8bb26 } /* Generic.Inserted */
body .go { color: #f2e5bc } /* Generic.Output */
body .gp { color: #a89984 } /* Generic.Prompt */
body .gs { color: #dddddd; font-weight: bold } /* Generic.Strong */
body .gu { color: #ebdbb2; text-decoration: underline } /* Generic.Subheading */
body .gt { color: #fb4934 } /* Generic.Traceback */
body .kc { color: #fb4934 } /* Keyword.Constant */
body .kd { color: #fb4934 } /* Keyword.Declaration */
body .kn { color: #fb4934 } /* Keyword.Namespace */
body .kp { color: #fb4934 } /* Keyword.Pseudo */
body .kr { color: #fb4934 } /* Keyword.Reserved */
body .kt { color: #fb4934 } /* Keyword.Type */
body .ld { color: #dddddd } /* Literal.Date */
body .m { color: #d3869b } /* Literal.Number */
body .s { color: #b8bb26 } /* Literal.String */
body .na { color: #fabd2f } /* Name.Attribute */
body .nb { color: #fe8019 } /* Name.Builtin */
body .nc { color: #8ec07c } /* Name.Class */
body .no { color: #d3869b } /* Name.Constant */
body .nd { color: #fb4934 } /* Name.Decorator */
body .ni { color: #dddddd } /* Name.Entity */
body .ne { color: #fb4934 } /* Name.Exception */
body .nf { color: #8ec07c } /* Name.Function */
body .nl { color: #dddddd } /* Name.Label */
body .nn { color: #8ec07c } /* Name.Namespace */
body .nx { color: #dddddd } /* Name.Other */
body .py { color: #dddddd } /* Name.Property */
body .nt { color: #8ec07c } /* Name.Tag */
body .nv { color: #83a598 } /* Name.Variable */
body .ow { color: #fb4934 } /* Operator.Word */
body .pm { color: #dddddd } /* Punctuation.Marker */
body .w { color: #dddddd } /* Text.Whitespace */
body .mb { color: #d3869b } /* Literal.Number.Bin */
body .mf { color: #d3869b } /* Literal.Number.Float */
body .mh { color: #d3869b } /* Literal.Number.Hex */
body .mi { color: #d3869b } /* Literal.Number.Integer */
body .mo { color: #d3869b } /* Literal.Number.Oct */
body .sa { color: #b8bb26 } /* Literal.String.Affix */
body .sb { color: #b8bb26 } /* Literal.String.Backtick */
body .sc { color: #b8bb26 } /* Literal.String.Char */
body .dl { color: #b8bb26 } /* Literal.String.Delimiter */
body .sd { color: #b8bb26 } /* Literal.String.Doc */
body .s2 { color: #b8bb26 } /* Literal.String.Double */
body .se { color: #fe8019 } /* Literal.String.Escape */
body .sh { color: #b8bb26 } /* Literal.String.Heredoc */
body .si { color: #b8bb26 } /* Literal.String.Interpol */
body .sx { color: #b8bb26 } /* Literal.String.Other */
body .sr { color: #b8bb26 } /* Literal.String.Regex */
body .s1 { color: #b8bb26 } /* Literal.String.Single */
body .ss { color: #b8bb26 } /* Literal.String.Symbol */
body .bp { color: #fe8019 } /* Name.Builtin.Pseudo */
body .fm { color: #8ec07c } /* Name.Function.Magic */
body .vc { color: #83a598 } /* Name.Variable.Class */
body .vg { color: #83a598 } /* Name.Variable.Global */
body .vi { color: #83a598 } /* Name.Variable.Instance */
body .vm { color: #83a598 } /* Name.Variable.Magic */
body .il { color: #d3869b } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="c1" title="Comment.Single"># The core janet library</span>
<span class="c1" title="Comment.Single"># Copyright 2023 Â© Calvin Rose</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Macros and Basic Functions</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">defn</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:macro</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  (defn name &amp; more)</span>

<span class="s" title="Literal.String">  Define a function. Equivalent to `(def name (fn name [args] ...))`.</span>
<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">defn</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">modifiers</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">docstr</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fstart</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ith</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">ith</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">i</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:string</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">docstr</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ith</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">modifiers</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ith</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">fstart</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">more</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># Add function signature to docstring</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">arglen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer </span><span class="s" title="Literal.String">&quot;(&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">arglen</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push-string </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/format </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;%j&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">index</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">modifiers</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;)\n\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">docstr</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># Build return value</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">modifiers</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">more</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">defmacro</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:macro</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Define a macro.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span><span class="w" title="Text.Whitespace"> </span><span class="c1" title="Comment.Single"># override old macro definitions in the case of a recursive macro</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">defn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:macro</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">as-macro</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Use a function or macro literal `f` as a macro. This lets</span>
<span class="s" title="Literal.String">  any function be used as a macro. Inside a quasiquote, the</span>
<span class="s" title="Literal.String">  idiom `(as-macro ,my-custom-macro arg1 arg2...)` can be used</span>
<span class="s" title="Literal.String">  to avoid unwanted variable capture of `my-custom-macro`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">defmacro-</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Define a private macro that will not be exported.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">defn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:macro</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:private</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">defn-</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Define a private function that will not be exported.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">defn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:private</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">def-</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Define a private value that will not be exported.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:private</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">var-</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Define a private var that will not be exported.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:private</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">toggle</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Set a value to its boolean inverse. Same as `(set value (not value))`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">value</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">not</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">defglobal</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Dynamically create a global def.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">name*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">name*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:value</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">})</span>
<span class="w" title="Text.Whitespace">  </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">varglobal</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Dynamically create a global var.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">init</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">name*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">name*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:ref</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">init</span><span class="p" title="Punctuation">]})</span>
<span class="w" title="Text.Whitespace">  </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>

<span class="c1" title="Comment.Single"># Basic predicates</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">nan?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is NaN.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">number?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a number.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:number</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">fiber?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a fiber.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:fiber</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">string?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a string.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:string</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">symbol?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a symbol.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:symbol</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">keyword?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a keyword.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keyword</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">buffer?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a buffer.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:buffer</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">function?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a function (not a cfunction).&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">cfunction?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x a cfunction.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:cfunction</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">table?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x a table.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:table</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">struct?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x a struct.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:struct</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">array?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is an array.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:array</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">tuple?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a tuple.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">boolean?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is a boolean.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:boolean</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">truthy?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is truthy.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true false</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="nv" title="Name.Variable">?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is true.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="nv" title="Name.Variable">?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is false.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="nv" title="Name.Variable">?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is nil.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">empty?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if xs is empty.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)))</span>

<span class="c1" title="Comment.Single"># For macros, we define an imcomplete odd? function that will be overriden.</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">odd?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mod </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">def- </span><span class="nv" title="Name.Variable">non-atomic-types</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">   </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">   </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">   </span><span class="no" title="Name.Constant">:buffer</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">   </span><span class="no" title="Name.Constant">:symbol</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">   </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">idempotent?</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Check if x is a value that evaluates to itself when compiled.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">non-atomic-types</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>

<span class="c1" title="Comment.Single"># C style macros and functions for imperative sugar. No bitwise though.</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">inc</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Returns x + 1.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">dec</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Returns x - 1.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">++</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Increments the var x by 1.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">+</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">--</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Decrements the var x by 1.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">-</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">+=</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Increments the var x by n.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">+</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">)))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">-=</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Decrements the var x by n.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">-</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">)))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">*=</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Shorthand for (set x (\\* x n)).&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">*</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">)))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">/=</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Shorthand for (set x (/ x n)).&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">/</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">)))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">%=</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Shorthand for (set x (% x n)).&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">%</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">ns</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">assert</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Throw an error if x is not truthy. Will not evaluate `err` if x is truthy.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">err</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">v</span>
<span class="w" title="Text.Whitespace">       </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">v</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">error</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">err</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">err</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/format </span><span class="s" title="Literal.String">&quot;assert failure in %j&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">errorf</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;A combination of `error` and `string/format`. Equivalent to `(error (string/format fmt ;args))`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fmt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/format </span><span class="nv" title="Name.Variable">fmt</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">default</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Define a default value for an optional argument.</span>
<span class="s" title="Literal.String">  Expands to `(def sym (if (= nil sym) val sym))`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">val</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">val</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">comment</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Ignores the body of the comment.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">])</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">if-not</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Shorthand for `(if (not condition) else then)`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">then</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">else</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">else</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">then</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">when</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Evaluates the body when the condition is true. Otherwise returns nil.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">unless</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Shorthand for `(when (not condition) ;body)`. &quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">cond</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Evaluates conditions sequentially until the first true condition</span>
<span class="s" title="Literal.String">  is found, and then executes the corresponding body. If there are an</span>
<span class="s" title="Literal.String">  odd number of forms, and no forms are matched, the last expression</span>
<span class="s" title="Literal.String">  is executed. If there are no matches, returns nil.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pairs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">restlen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pairs</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">restlen</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span>
<span class="k k-Constants" title="Keyword.Constants">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">restlen</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">pairs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">case</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Select the body that equals the dispatch value. When `pairs`</span>
<span class="s" title="Literal.String">  has an odd number of elements, the last is the default expression.</span>
<span class="s" title="Literal.String">  If no match is found, returns nil.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">dispatch</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pairs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">atm</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">idempotent? </span><span class="nv" title="Name.Variable">dispatch</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">atm</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dispatch</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">restlen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pairs</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">restlen</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span>
<span class="k k-Constants" title="Keyword.Constants">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">restlen</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">pairs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">atm</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">do</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dispatch</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">let</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Create a scope and bind values to symbols. Each pair in `bindings` is</span>
<span class="s" title="Literal.String">  assigned as if with `def`, and the body of the `let` form returns the last</span>
<span class="s" title="Literal.String">  value.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">odd? </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bindings</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;expected even number of bindings to let&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bindings</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">do</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bindings</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">try</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Try something and catch errors. `body` is any expression,</span>
<span class="s" title="Literal.String">  and `catch` should be a form, the first element of which is a tuple. This tuple</span>
<span class="s" title="Literal.String">  should contain a binding for errors and an optional binding for</span>
<span class="s" title="Literal.String">  the fiber wrapping the body. Returns the result of `body` if no error,</span>
<span class="s" title="Literal.String">  or the result of `catch` if an error.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">body</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">catch</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[[</span><span class="nv" title="Name.Variable">err</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fib</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">catch</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ie</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/status</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:error</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">err</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">fib</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fib</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">catch</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">protect</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Evaluate expressions, while capturing any errors. Evaluates to a tuple</span>
<span class="s" title="Literal.String">  of two elements. The first element is true if successful, false if an</span>
<span class="s" title="Literal.String">  error, and the second is the return value or error.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ie</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">[(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">not=</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/status</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">])))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">and</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Evaluates to the last argument if all preceding elements are truthy, otherwise</span>
<span class="s" title="Literal.String">  evaluates to the first falsey argument.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">forms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">               </span><span class="nv" title="Name.Variable">v</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">idempotent? </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                   </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">])))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">or</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Evaluates to the last argument if all preceding elements are falsey, otherwise</span>
<span class="s" title="Literal.String">  evaluates to the first truthy element.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">forms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fi</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">forms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">idempotent? </span><span class="nv" title="Name.Variable">fi</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fi</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fi</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">$fi</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">do</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">$fi</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fi</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">$fi</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">$fi</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">with-syms</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Evaluates `body` with each symbol in `syms` bound to a generated, unique symbol.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">syms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">syms</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">syms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">gensym</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">accum</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">defer</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Run `form` unconditionally after `body`, even if the body throws an error.</span>
<span class="s" title="Literal.String">  Will also run `form` if a user signal 0-4 is received.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ti</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">form</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/status</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:dead</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">propagate</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">edefer</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Run `form` after `body` in the case that body terminates abnormally (an error or user signal 0-4).</span>
<span class="s" title="Literal.String">  Otherwise, return last form in `body`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ti</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/status</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:dead</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">propagate</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">prompt</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Set up a checkpoint that can be returned to. `tag` should be a value</span>
<span class="s" title="Literal.String">  that is used in a `return` statement, like a keyword.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">tag</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">target</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">payload</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fib</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fib</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">tag</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)])</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:i0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fib</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">target</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">payload</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">tag</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">target</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">payload</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">propagate</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fib</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">chr</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Convert a string of length 1 to its byte (ascii) value at compile time.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/format </span><span class="s" title="Literal.String">&quot;expected string of length 1, got %v&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">label</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Set a label point that is lexically scoped. `name` should be a symbol</span>
<span class="s" title="Literal.String">  that will be bound to the label.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">@&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">prompt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">return</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Return to a prompt point.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">to</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">signal </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">to</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">]))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">with</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Evaluate `body` with some resource, which will be automatically cleaned up</span>
<span class="s" title="Literal.String">  if there is an error in `body`. `binding` is bound to the expression `ctor`, and</span>
<span class="s" title="Literal.String">  `dtor` is a function or callable that is passed the binding. If no destructor</span>
<span class="s" title="Literal.String">  (`dtor`) is given, will call :close on the resource.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ctor</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dtor</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ctor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">defer</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">dtor</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:close</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">when-with</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Similar to with, but if binding is false or nil, returns</span>
<span class="s" title="Literal.String">  nil without evaluating the body. Otherwise, the same as `with`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ctor</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dtor</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ctor</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">defer</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">dtor</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:close</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">if-with</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Similar to `with`, but if binding is false or nil, evaluates</span>
<span class="s" title="Literal.String">  the falsey path. Otherwise, evaluates the truthy path. In both cases,</span>
<span class="s" title="Literal.String">  `ctor` is bound to binding.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ctor</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dtor</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">truthy</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ctor</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">defer</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">dtor</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:close</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">truthy</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">,</span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">for-var-template</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">step</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">comparison</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">delta</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">st</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">idempotent? </span><span class="nv" title="Name.Variable">step</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">step</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">loop-body</span>
<span class="w" title="Text.Whitespace">      </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">comparison</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">delta</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">st</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">start</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">stop</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">st</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">step</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">st</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">step</span><span class="p" title="Punctuation">)])</span>
<span class="w" title="Text.Whitespace">       </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">number? </span><span class="nv" title="Name.Variable">st</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="nv" title="Name.Variable">st</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">loop-body</span>
<span class="w" title="Text.Whitespace">          </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">&gt;</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">st</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">loop-body</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">for-template</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">step</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">comparison</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">delta</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for</span><span class="nv" title="Name.Variable">-var-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">step</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">comparison</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">delta</span>
<span class="w" title="Text.Whitespace">                    </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">check-indexed</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">indexed? </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">x</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;expected tuple for range, got &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">range-template</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">op</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">comparison</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">step</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">check-indexed</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">kind</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">step</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">comparison</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">op</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:down</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">step</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">comparison</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">op</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">]))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">each-template</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inx</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">idempotent? </span><span class="nv" title="Name.Variable">inx</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inx</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">       </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inx</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">inx</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">next</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">not=</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">binding</span>
<span class="w" title="Text.Whitespace">           </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">kind</span>
<span class="w" title="Text.Whitespace">              </span><span class="no" title="Name.Constant">:each</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">in</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span>
<span class="w" title="Text.Whitespace">              </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">in</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)]))</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">next</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">iterate-template</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expr</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">expr</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">loop1</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">body</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Terminate recursion</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">verb</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># 2 term expression</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keyword? </span><span class="nv" title="Name.Variable">binding</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop</span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">binding</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:until</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:while</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:let</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:after</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:before</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:repeat</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">iter</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">                    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">iter</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">iter</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">iter</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:when</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:unless</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">verb</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;unexpected loop modifier &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="p" title="Punctuation">))))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># 3 term expression</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop</span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">3</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">verb</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">+</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:range-to</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">+</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;=</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:down</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:down</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">-</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&gt;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:down-to</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:down</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">rest</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">-</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&gt;=</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:each</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:iterate</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">iterate-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">object</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">rest</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;unexpected loop verb &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">verb</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">forv</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Do a C-style for-loop for side effects. The iteration variable `i`</span>
<span class="s" title="Literal.String">  can be mutated in the loop, unlike normal `for`. Returns nil.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for</span><span class="nv" title="Name.Variable">-var-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">+</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">for</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Do a C-style for-loop for side effects. Returns nil.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stop</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">+</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">eachk</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Loop over each key in `ds`. Returns nil.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">eachp</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Loop over each (key, value) pair in `ds`. Returns nil.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">repeat</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Evaluate body n times. If n is negative, body will be evaluated 0 times. Evaluates to nil.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">iter</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">iter</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">iter</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">iter</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">forever</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Evaluate body forever in a loop, or until a break statement.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">each</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Loop over each value in `ds`. Returns nil.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:each</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">loop</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  A general purpose loop macro. This macro is similar to the Common Lisp loop</span>
<span class="s" title="Literal.String">  macro, although intentionally much smaller in scope.  The head of the loop</span>
<span class="s" title="Literal.String">  should be a tuple that contains a sequence of either bindings or</span>
<span class="s" title="Literal.String">  conditionals. A binding is a sequence of three values that define something</span>
<span class="s" title="Literal.String">  to loop over. Bindings are written in the format:</span>

<span class="s" title="Literal.String">      binding :verb object/expression</span>

<span class="s" title="Literal.String">  where `binding` is a binding as passed to def, `:verb` is one of a set of</span>
<span class="s" title="Literal.String">  keywords, and `object` is any expression. Each subsequent binding creates a</span>
<span class="s" title="Literal.String">  nested loop within the loop created by the previous binding.</span>

<span class="s" title="Literal.String">  The available verbs are:</span>

<span class="s" title="Literal.String">  * `:iterate` -- repeatedly evaluate and bind to the expression while it is</span>
<span class="s" title="Literal.String">    truthy.</span>

<span class="s" title="Literal.String">  * `:range` -- loop over a range. The object should be a two-element tuple with</span>
<span class="s" title="Literal.String">    a start and end value, and an optional positive step. The range is half</span>
<span class="s" title="Literal.String">    open, [start, end).</span>

<span class="s" title="Literal.String">  * `:range-to` -- same as :range, but the range is inclusive [start, end].</span>

<span class="s" title="Literal.String">  * `:down` -- loop over a range, stepping downwards. The object should be a</span>
<span class="s" title="Literal.String">    two-element tuple with a start and (exclusive) end value, and an optional</span>
<span class="s" title="Literal.String">    (positive!) step size.</span>

<span class="s" title="Literal.String">  * `:down-to` -- same as :down, but the range is inclusive [start, end].</span>

<span class="s" title="Literal.String">  * `:keys` -- iterate over the keys in a data structure.</span>

<span class="s" title="Literal.String">  * `:pairs` -- iterate over the key-value pairs as tuples in a data structure.</span>

<span class="s" title="Literal.String">  * `:in` -- iterate over the values in a data structure or fiber.</span>

<span class="s" title="Literal.String">  `loop` also accepts conditionals to refine the looping further. Conditionals are of</span>
<span class="s" title="Literal.String">  the form:</span>

<span class="s" title="Literal.String">      :modifier argument</span>

<span class="s" title="Literal.String">  where `:modifier` is one of a set of keywords, and `argument` is keyword-dependent.</span>
<span class="s" title="Literal.String">  `:modifier` can be one of:</span>

<span class="s" title="Literal.String">  * `:while expression` -- breaks from the current loop if `expression` is</span>
<span class="s" title="Literal.String">    falsey.</span>

<span class="s" title="Literal.String">  * `:until expression` -- breaks from the current loop if `expression` is</span>
<span class="s" title="Literal.String">    truthy.</span>

<span class="s" title="Literal.String">  * `:let bindings` -- defines bindings inside the current loop as passed to the</span>
<span class="s" title="Literal.String">    `let` macro.</span>

<span class="s" title="Literal.String">  * `:before form` -- evaluates a form for a side effect before the next inner</span>
<span class="s" title="Literal.String">    loop.</span>

<span class="s" title="Literal.String">  * `:after form` -- same as `:before`, but the side effect happens after the</span>
<span class="s" title="Literal.String">    next inner loop.</span>

<span class="s" title="Literal.String">  * `:repeat n` -- repeats the next inner loop `n` times.</span>

<span class="s" title="Literal.String">  * `:when condition` -- only evaluates the current loop body when `condition`</span>
<span class="s" title="Literal.String">    is truthy.</span>

<span class="s" title="Literal.String">  * `:unless condition` -- only evaluates the current loop body when `condition`</span>
<span class="s" title="Literal.String">    is falsey.</span>

<span class="s" title="Literal.String">  The `loop` macro always evaluates to nil.</span>
<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop</span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">seq</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Similar to `loop`, but accumulates the loop body into an array and returns that.</span>
<span class="s" title="Literal.String">  See `loop` for details.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">array/push</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">catseq</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Similar to `loop`, but concatenates each element from the loop body into an array and returns that.</span>
<span class="s" title="Literal.String">  See `loop` for details.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">array/concat</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">tabseq</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Similar to `loop`, but accumulates key value pairs into a table.</span>
<span class="s" title="Literal.String">  See `loop` for details.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key-body</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value-body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">put</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">key-body</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">value-body</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">$accum</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">generate</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Create a generator expression using the `loop` syntax. Returns a fiber</span>
<span class="s" title="Literal.String">  that yields all values inside the loop in order. See `loop` for details.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">yield </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))))</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:yi</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">coro</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;A wrapper for making fibers that may yield multiple values (coroutine). Same as `(fiber/new (fn [] ;body) :yi)`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">fn</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:yi</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">fiber-fn</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;A wrapper for making fibers. Same as `(fiber/new (fn [] ;body) flags)`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">flags</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">fn</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">flags</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">sum</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns the sum of xs. If xs is empty, returns 0.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">accum</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">mean</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns the mean of xs. If empty, returns NaN.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">lengthable? </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">/ </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sum </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">total</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">total</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">/ </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">total</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">product</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns the product of xs. If xs is empty, returns 1.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">*= </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">accum</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">if-let</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Make multiple bindings, and if all are truthy,</span>
<span class="s" title="Literal.String">  evaluate the `tru` form. If any are false or nil, evaluate</span>
<span class="s" title="Literal.String">  the `fal` form. Bindings have the same syntax as the `let` macro.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tru</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fal</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bindings</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;expected at least 1 binding&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">odd? </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;expected an even number of bindings&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">tru</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">bl</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">br</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol? </span><span class="nv" title="Name.Variable">bl</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">bl</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">br</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">br</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">             </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">bl</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))))))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">aux</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fal</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">when-let</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Same as `(if-let bindings (do ;body))`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">comp</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Takes multiple functions and returns a function that is the composition</span>
<span class="s" title="Literal.String">  of those functions.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">functions</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">functions</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span>
<span class="k k-Constants" title="Keyword.Constants">    </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">functions</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">g</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">functions</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">g</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="mf" title="Literal.Number.Float">3</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">h</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">functions</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">g</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="mf" title="Literal.Number.Float">4</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">functions</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">g</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">functions</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">comp </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">g</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">            </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">functions</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">4</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-1</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">identity</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;A function that returns its argument.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">complement</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns a function that is the complement to the argument.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">do-extreme</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">order</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">not=</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">order</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">     </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">extreme</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Returns the most extreme value in `args` based on the function `order`.</span>
<span class="s" title="Literal.String">  `order` should take two values and return true or false (a comparison).</span>
<span class="s" title="Literal.String">  Returns nil if `args` is empty.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">order</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-extreme</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">order</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">max</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns the numeric maximum of the arguments.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-extreme</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&gt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">min</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns the numeric minimum of the arguments.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-extreme</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">max-of</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns the numeric maximum of the argument sequence.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-extreme</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&gt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">min-of</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns the numeric minimum of the argument sequence.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-extreme</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">first</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the first element from an indexed data structure.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">last</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the last element from an indexed data structure.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>

<span class="c1" title="Comment.Single">## Polymorphic comparisons</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">do-compare</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:compare</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:compare</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cmp </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">compare</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Polymorphic compare. Returns -1, 0, 1 for x &lt; y, x = y, x &gt; y respectively.</span>
<span class="s" title="Literal.String">  Differs from the primitive comparators in that it first checks to</span>
<span class="s" title="Literal.String">  see whether either x or y implement a `compare` method which can</span>
<span class="s" title="Literal.String">  compare x and y. If so, it uses that method. If not, it</span>
<span class="s" title="Literal.String">  delegates to the primitive comparators.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-compare</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">compare-reduce</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">op</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">op</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-compare</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">     </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">compare=</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Equivalent of `=` but using polymorphic `compare` instead of primitive comparator.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare</span><span class="nv" title="Name.Variable">-reduce</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">compare&lt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Equivalent of `&lt;` but using polymorphic `compare` instead of primitive comparator.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare</span><span class="nv" title="Name.Variable">-reduce</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">compare&lt;=</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Equivalent of `&lt;=` but using polymorphic `compare` instead of primitive comparator.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare</span><span class="nv" title="Name.Variable">-reduce</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">compare&gt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Equivalent of `&gt;` but using polymorphic `compare` instead of primitive comparator.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare</span><span class="nv" title="Name.Variable">-reduce</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&gt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">compare&gt;=</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Equivalent of `&gt;=` but using polymorphic `compare` instead of primitive comparator.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare</span><span class="nv" title="Name.Variable">-reduce</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&gt;=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">zero?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is zero.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">pos?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is greater than 0.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">neg?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is less than 0.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-1</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">one?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is equal to 1.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">even?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is even.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mod </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">odd?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Check if x is odd.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compare </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mod </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Indexed Combinators</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">median-of-three</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">z</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">z</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">z</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">z</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">z</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">z</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">z</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">sort-partition-template</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pivot</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">before?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">left</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">pivot</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">left</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">before?</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">pivot</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">sort-help</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lo</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">hi</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">lo</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">hi</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">z</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lo</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">div </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">lo</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">hi</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">hi</span><span class="p" title="Punctuation">)])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">pivot</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">median-of-three</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">z</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lo</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">right</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">hi</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">before?</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">&lt;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort</span><span class="nv" title="Name.Variable">-partition-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pivot</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">&gt;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort</span><span class="nv" title="Name.Variable">-partition-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&gt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pivot</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort</span><span class="nv" title="Name.Variable">-partition-template</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pivot</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">tmp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">left</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">left</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tmp</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">left</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">lo</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort</span><span class="nv" title="Name.Variable">-help</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lo</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">right</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">hi</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort</span><span class="nv" title="Name.Variable">-help</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">hi</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">a</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">sort</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Sorts `ind` in-place, and returns it. Uses quick-sort and is not a stable sort.</span>
<span class="s" title="Literal.String">  If a `before?` comparator function is provided, sorts elements using that,</span>
<span class="s" title="Literal.String">  otherwise uses `&lt;`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">before?</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&lt;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort</span><span class="nv" title="Name.Variable">-help</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">sort-by</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Sorts `ind` in-place by calling a function `f` on each element and</span>
<span class="s" title="Literal.String">  comparing the result with `&lt;`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">sorted</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Returns a new sorted array without modifying the old one.</span>
<span class="s" title="Literal.String">  If a `before?` comparator function is provided, sorts elements using that,</span>
<span class="s" title="Literal.String">  otherwise uses `&lt;`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/slice </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">before?</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">sorted-by</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Returns a new sorted array that compares elements by invoking</span>
<span class="s" title="Literal.String">  a function `f` on each element and comparing the result with `&lt;`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sorted </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">reduce</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Reduce, also know as fold-left in many languages, transforms</span>
<span class="s" title="Literal.String">  an indexed type (array, tuple) with a function to produce a value by applying `f` to</span>
<span class="s" title="Literal.String">  each element in order. `f` is a function of 2 arguments, `(f accum el)`, where</span>
<span class="s" title="Literal.String">  `accum` is the initial value and `el` is the next value in the indexed type `ind`.</span>
<span class="s" title="Literal.String">  `f` returns a value that will be used as `accum` in the next call to `f`. `reduce`</span>
<span class="s" title="Literal.String">  returns the value of the final call to `f`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">init</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">init</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">el</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">accum</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">reduce2</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``The 2-argument version of `reduce` that does not take an initialization value.</span>
<span class="s" title="Literal.String">  Instead, the first element of the array is used for initialization.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">accumulate</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Similar to `reduce`, but accumulates intermediate values into an array.</span>
<span class="s" title="Literal.String">  The last element in the array is what would be the return value from `reduce`.</span>
<span class="s" title="Literal.String">  The `init` value is not added to the array (the return value will have the same</span>
<span class="s" title="Literal.String">  number of elements as `ind`).</span>
<span class="s" title="Literal.String">  Returns a new array.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">init</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">init</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">accumulate2</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``The 2-argument version of `accumulate` that does not take an initialization value.</span>
<span class="s" title="Literal.String">  The first value in `ind` will be added to the array as is, so the length of the</span>
<span class="s" title="Literal.String">  return value will be `(length ind)`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">map-aggregator</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Aggregation logic for various map functions.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">val</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">maptype</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:map</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">val</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:mapcat</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">val</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:keep</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">val</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:count</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">val</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:some</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">val</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:all</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">val</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">map-n</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Generates efficient map logic for a specific number of</span>
<span class="s" title="Literal.String">  indexed beyond the first.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span>
<span class="w" title="Text.Whitespace">       </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]]</span>
<span class="w" title="Text.Whitespace">           </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-aggregator</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))))))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro- </span><span class="nv" title="Name.Variable">map-template</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ninds</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">ninds</span>
<span class="w" title="Text.Whitespace">       </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-aggregator</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">       </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="mf" title="Literal.Number.Float">3</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">3</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">iter-keys</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="nv" title="Name.Variable">ninds</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">call-buffer</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="nv" title="Name.Variable">ninds</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">done</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ind</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ninds</span>
<span class="w" title="Text.Whitespace">             </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">old-key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">iter-keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                   </span><span class="nv" title="Name.Variable">ii</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">inds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                   </span><span class="nv" title="Name.Variable">new-key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ii</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">old-key</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">new-key</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">done</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">iter-keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-key</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">call-buffer</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ii</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-key</span><span class="p" title="Punctuation">))))))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">done</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-aggregator</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">maptype</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">call-buffer</span><span class="p" title="Punctuation">)))))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">map</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Map a function over every value in a data structure and</span>
<span class="s" title="Literal.String">  return an array of the results.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:map</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">mapcat</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Map a function over every element in an array or tuple and</span>
<span class="s" title="Literal.String">  use `array/concat` to concatenate the results.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:mapcat</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">filter</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Given a predicate, take only elements from an array or tuple for</span>
<span class="s" title="Literal.String">  which `(pred element)` is truthy. Returns a new array.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">item</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">count</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Count the number of items in `ind` for which `(pred item)`</span>
<span class="s" title="Literal.String">  is true.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:count</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">keep</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Given a predicate `pred`, return a new array containing the truthy results</span>
<span class="s" title="Literal.String">  of applying `pred` to each element in the indexed collection `ind`. This is</span>
<span class="s" title="Literal.String">  different from `filter` which returns an array of the original elements where</span>
<span class="s" title="Literal.String">  the predicate is truthy.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keep</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">find-index</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Find the index of indexed type for which `pred` is true. Returns `dflt` if not found.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">item</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">find</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Find the first value in an indexed collection that satisfies a predicate. Returns</span>
<span class="s" title="Literal.String">  `dflt` if not found.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">item</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">index-of</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Find the first key associated with a value x in a data structure, acting like a reverse lookup.</span>
<span class="s" title="Literal.String">  Will not look at table prototypes.</span>
<span class="s" title="Literal.String">  Returns `dflt` if not found.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">take-n-slice</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">m</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">take</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Take the first n elements of a fiber, indexed or bytes type. Returns a new array, tuple or string,</span>
<span class="s" title="Literal.String">  respectively. If `n` is negative, takes the last `n` elements instead.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">indexed? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">take</span><span class="nv" title="Name.Variable">-n-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tuple/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bytes? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">take</span><span class="nv" title="Name.Variable">-n-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">string/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dictionary? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tabseq </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:until</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="nv" title="Name.Variable">left</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">repeat </span><span class="nv" title="Name.Variable">n</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">take-until-slice</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find-index </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">nil? </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">take-until</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Same as `(take-while (complement pred) ind)`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">indexed? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">take-until</span><span class="nv" title="Name.Variable">-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tuple/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bytes? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">take-until</span><span class="nv" title="Name.Variable">-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">string/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dictionary? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tabseq </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:until</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:until</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">take-while</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Given a predicate, take only elements from a fiber, indexed, or bytes type that satisfy</span>
<span class="s" title="Literal.String">  the predicate, and abort on first failure. Returns a new array, tuple, or string, respectively.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">take-until </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">complement </span><span class="nv" title="Name.Variable">pred</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">drop-n-slice</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">drop-n-dict</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">left</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:until</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="nv" title="Name.Variable">left</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">drop</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Drop the first `n` elements in an indexed or bytes type. Returns a new tuple or string</span>
<span class="s" title="Literal.String">  instance, respectively. If `n` is negative, drops the last `n` elements instead.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">indexed? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop</span><span class="nv" title="Name.Variable">-n-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tuple/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bytes? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop</span><span class="nv" title="Name.Variable">-n-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">string/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">struct? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop</span><span class="nv" title="Name.Variable">-n-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">struct/to-table</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop</span><span class="nv" title="Name.Variable">-n-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">table/clone</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">repeat </span><span class="nv" title="Name.Variable">n</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">drop-until-slice</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find-index </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">nil? </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">drop-until-dict</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:until</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">drop-until</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Same as `(drop-while (complement pred) ind)`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">indexed? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop-until</span><span class="nv" title="Name.Variable">-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tuple/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bytes? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop-until</span><span class="nv" title="Name.Variable">-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">string/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">struct? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop-until</span><span class="nv" title="Name.Variable">-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">struct/to-table</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop-until</span><span class="nv" title="Name.Variable">-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">table/clone</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">drop-while</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Given a predicate, remove elements from an indexed or bytes type that satisfy</span>
<span class="s" title="Literal.String">  the predicate, and abort on first failure. Returns a new tuple or string, respectively.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">drop-until </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">complement </span><span class="nv" title="Name.Variable">pred</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">juxt*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Returns the juxtaposition of functions. In other words,</span>
<span class="s" title="Literal.String">  `((juxt* a b c) x)` evaluates to `[(a x) (b x) (c x)]`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">funs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">funs</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">juxt</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Macro form of `juxt*`. Same behavior but more efficient.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">funs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">tuple</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">$args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">funs</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">apply</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">$args</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">fn</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">$args</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">defdyn</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Define an alias for a keyword that is used as a dynamic binding. The</span>
<span class="s" title="Literal.String">  alias is a normal, lexically scoped binding that can be used instead of</span>
<span class="s" title="Literal.String">  a keyword to prevent typos. `defdyn` does not set dynamic bindings or otherwise</span>
<span class="s" title="Literal.String">  replace `dyn` and `setdyn`. The alias _must_ start and end with the `*` character, usually</span>
<span class="s" title="Literal.String">  called &quot;earmuffs&quot;.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">alias</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">assert </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol? </span><span class="nv" title="Name.Variable">alias</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;alias must be a symbol&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">assert </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">alias</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">42</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">first </span><span class="nv" title="Name.Variable">alias</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="nv" title="Name.Variable">alias</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;name must have leading and trailing &#39;*&#39; characters&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="no" title="Name.Constant">:defdyn-prefix</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">kw</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keyword </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slice </span><span class="nv" title="Name.Variable">alias</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">alias</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:dyn</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">more</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">kw</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">has-key?</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Check if a data structure `ds` contains the key `key`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">has-value?</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Check if a data structure `ds` contains the value `value`. Will run in time proportional to the size of `ds`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">index-of </span><span class="nv" title="Name.Variable">value</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*defdyn-prefix*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">``Optional namespace prefix to add to keywords declared with `defdyn`.</span>
<span class="s" title="Literal.String">  Use this to prevent keyword collisions between dynamic bindings.``</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*out*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Where normal print functions print output to.&quot;</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*err*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Where error printing prints output to.&quot;</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*redef*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;When set, allow dynamically rebinding top level defs. Will slow generated code and is intended to be used for development.&quot;</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*debug*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Enables a built in debugger on errors and other useful features for debugging in a repl.&quot;</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*exit*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;When set, will cause the current context to complete. Can be set to exit from repl (or file), for example.&quot;</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*exit-value*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Set the return value from `run-context` upon an exit. By default, `run-context` will return nil.&quot;</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*task-id*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;When spawning a thread or fiber, the task-id can be assigned for concurrency control.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*macro-form*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Inside a macro, is bound to the source form that invoked the macro&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*lint-error*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;The current lint error level. The error level is the lint level at which compilation will exit with an error and not continue.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*lint-warn*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;The current lint warning level. The warning level is the lint level at which and error will be printed but compilation will continue as normal.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*lint-levels*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;A table of keyword alias to numbers denoting a lint level. Can be used to provided custom aliases for numeric lint levels.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*current-file*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Bound to the name of the currently compiling file.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">tracev</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Print to stderr a value and a description of the form that produced that value.</span>
<span class="s" title="Literal.String">  Evaluates to x.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/sourcemap </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*macro-form*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">())))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">cf</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*current-file*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fmt-1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">cf</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/format </span><span class="s" title="Literal.String">&quot;trace [%s]&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cf</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;trace&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fmt-2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">neg? </span><span class="nv" title="Name.Variable">l</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">neg? </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/format </span><span class="s" title="Literal.String">&quot; on line %d, column %d:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fmt</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">fmt-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fmt-2</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; %j is &quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">upscope</span>
<span class="k" title="Keyword">     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">eprinf</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fmt</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;,</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">eprintf</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">dyn</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pretty-format</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;%q&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">keep-syntax</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Creates a tuple with the tuple type and sourcemap of `before` but the</span>
<span class="s" title="Literal.String">  elements of `after`. If either one of its arguments is not a tuple, returns</span>
<span class="s" title="Literal.String">  `after` unmodified. Useful to preserve syntactic information when transforming</span>
<span class="s" title="Literal.String">  an ast in macros.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">before</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">before</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:parens</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/type </span><span class="nv" title="Name.Variable">before</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/brackets </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/setmap </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/sourcemap </span><span class="nv" title="Name.Variable">before</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">keep-syntax!</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Like `keep-syntax`, but if `after` is an array, it is coerced into a tuple.</span>
<span class="s" title="Literal.String">  Useful to preserve syntactic information when transforming an ast in macros.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">before</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keep-syntax </span><span class="nv" title="Name.Variable">before</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                        </span><span class="nv" title="Name.Variable">after</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">-&gt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Threading macro. Inserts x as the second value in the first form</span>
<span class="s" title="Literal.String">  in `forms`, and inserts the modified first form into the second form</span>
<span class="s" title="Literal.String">  in the same manner, and so on. Useful for expressing pipelines of data.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">last</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/slice </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keep-syntax! </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parts</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reduce </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">-&gt;&gt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Threading macro. Inserts x as the last value in the first form</span>
<span class="s" title="Literal.String">  in `forms`, and inserts the modified first form into the second form</span>
<span class="s" title="Literal.String">  in the same manner, and so on. Useful for expressing pipelines of data.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">last</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/slice </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">h</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">last</span><span class="p" title="Punctuation">]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keep-syntax! </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parts</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reduce </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">-?&gt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Short circuit threading macro. Inserts x as the second value in the first form</span>
<span class="s" title="Literal.String">  in `forms`, and inserts the modified first form into the second form</span>
<span class="s" title="Literal.String">  in the same manner, and so on. The pipeline will return nil</span>
<span class="s" title="Literal.String">  if an intermediate value is nil.</span>
<span class="s" title="Literal.String">  Useful for expressing pipelines of data.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">last</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/slice </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">last</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keep-syntax! </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parts</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reduce </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">-?&gt;&gt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Short circuit threading macro. Inserts x as the last value in the first form</span>
<span class="s" title="Literal.String">  in `forms`, and inserts the modified first form into the second form</span>
<span class="s" title="Literal.String">  in the same manner, and so on. The pipeline will return nil</span>
<span class="s" title="Literal.String">  if an intermediate value is nil.</span>
<span class="s" title="Literal.String">  Useful for expressing pipelines of data.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">last</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/slice </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">h</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">last</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keep-syntax! </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parts</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reduce </span><span class="nv" title="Name.Variable">fop</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">walk-ind</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">walk-dict</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">walk</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Iterate over the values in ast and apply `f`</span>
<span class="s" title="Literal.String">  to them. Collect the results in a data structure. If ast is not a</span>
<span class="s" title="Literal.String">  table, struct, array, or tuple,</span>
<span class="s" title="Literal.String">  returns form.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/to-struct </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keep-syntax! </span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">postwalk</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Do a post-order traversal of a data structure and call `(f x)`</span>
<span class="s" title="Literal.String">  on every visitation.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">postwalk </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">prewalk</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Similar to `postwalk`, but do pre-order traversal.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">prewalk </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">as-&gt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Thread forms together, replacing `as` in `forms` with the value</span>
<span class="s" title="Literal.String">  of the previous form. The first form is the value x. Returns the</span>
<span class="s" title="Literal.String">  last value.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">as</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">prev</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">next-prev</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">postwalk </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">as</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">prev</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">prev</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">next-prev</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">prev</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">as?-&gt;</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Thread forms together, replacing `as` in `forms` with the value</span>
<span class="s" title="Literal.String">  of the previous form. The first form is the value x. If any</span>
<span class="s" title="Literal.String">  intermediate values are falsey, return nil; otherwise, returns the</span>
<span class="s" title="Literal.String">  last value.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">as</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">prev</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">next-prev</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">postwalk </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">as</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">prev</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">prev</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">next-prev</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">prev</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">with-dyns</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Run a block of code in a new fiber that has some</span>
<span class="s" title="Literal.String">  dynamic bindings set. The fiber will not mask errors</span>
<span class="s" title="Literal.String">  or signals, but the dynamic bindings will be properly</span>
<span class="s" title="Literal.String">  unset, as dynamic bindings are fiber-local.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">dyn-forms</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bindings</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">]]</span>
<span class="w" title="Text.Whitespace">      </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">dyn-forms</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:p</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">with-vars</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Evaluates `body` with each var in `vars` temporarily bound. Similar signature to</span>
<span class="s" title="Literal.String">  `let`, but each binding must be a var.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">vars</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">vars</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">even? </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;expected even number of argument to vars&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">temp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">saveold</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">temp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">/ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">vars</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)]))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">setnew</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">set</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">vars</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">vars</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))]))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">restoreold</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">set</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">vars</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">temp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">/ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))]))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">       </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">saveold</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">setnew</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ti</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">       </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">restoreold</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fiber/status</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:dead</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">propagate</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">partial</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Partial function application.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">zero? </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">more</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">more</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">every?</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Evaluates to the last element of `ind` if all preceding elements are truthy,</span>
<span class="s" title="Literal.String">  otherwise evaluates to the first falsey element.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:while</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">any?</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Evaluates to the last element of `ind` if all preceding elements are falsey,</span>
<span class="s" title="Literal.String">  otherwise evaluates to the first truthy element.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:until</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">reverse!</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Reverses the order of the elements in a given array or buffer and returns it</span>
<span class="s" title="Literal.String">  mutated.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">j</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="nv" title="Name.Variable">j</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ti</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">j</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">j</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ti</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">reverse</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Reverses the order of the elements in a given array or tuple and returns</span>
<span class="s" title="Literal.String">  a new array. If a string or buffer is provided, returns a buffer instead.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">lengthable? </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bytes? </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/new-filled </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">-- </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reverse! </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">invert</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Given an associative data structure `ds`, returns a new table where the</span>
<span class="s" title="Literal.String">  keys of `ds` are the values, and the values are the keys. If multiple keys</span>
<span class="s" title="Literal.String">  in `ds` are mapped to the same value, only one of those values will</span>
<span class="s" title="Literal.String">  become a key in the returned table.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">zipcoll</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Creates a table from two arrays/tuples.</span>
<span class="s" title="Literal.String">  Returns a new table.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">vs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">kk</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">vk</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">kk</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kk</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">kk</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">vk</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">vs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">vk</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">vk</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kk</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">vs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">vk</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">get-in</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Access a value in a nested data structure. Looks into the data structure via</span>
<span class="s" title="Literal.String">  a sequence of keys. If value is not found, and `dflt` is provided, returns `dflt`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:while</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">nil? </span><span class="nv" title="Name.Variable">d</span><span class="p" title="Punctuation">))]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">d</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dflt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">d</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">update-in</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Update a value in a nested data structure `ds`. Looks into `ds` via a sequence of keys,</span>
<span class="s" title="Literal.String">  and replaces the value found there with `f` applied to that value.</span>
<span class="s" title="Literal.String">  Missing data structures will be replaced with tables. Returns</span>
<span class="s" title="Literal.String">  the modified, original data structure.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len-1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ks</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">len-1</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;expected at least 1 key in ks&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len-1</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">newv</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">newv</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">newv</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">last-key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len-1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">last-val</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last-key</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last-key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last-val</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">put-in</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Put a value into a nested data structure `ds`. Looks into `ds` via</span>
<span class="s" title="Literal.String">  a sequence of keys. Missing data structures will be replaced with tables. Returns</span>
<span class="s" title="Literal.String">  the modified, original data structure.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len-1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ks</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">len-1</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;expected at least 1 key in ks&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len-1</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">newv</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">newv</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">newv</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">last-key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len-1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">last-val</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last-key</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last-key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">update</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``For a given key in data structure `ds`, replace its corresponding value with the</span>
<span class="s" title="Literal.String">  result of calling `func` on that value. If `args` are provided, they will be passed</span>
<span class="s" title="Literal.String">  along to `func` as well. Returns `ds`, updated.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">func</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">old</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">func</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">old</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">merge-into</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Merges multiple tables/structs into table `tab`. If a key appears in more than one</span>
<span class="s" title="Literal.String">  collection in `colls`, then later values replace any previous ones. Returns `tab`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">tab</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">colls</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">colls</span>
<span class="w" title="Text.Whitespace">         </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">tab</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">tab</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">merge</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Merges multiple tables/structs into one new table. If a key appears in more than one</span>
<span class="s" title="Literal.String">  collection in `colls`, then later values replace any previous ones.</span>
<span class="s" title="Literal.String">  Returns the new table.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">colls</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">container</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">colls</span>
<span class="w" title="Text.Whitespace">         </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">container</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">container</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">keys</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the keys of an associative data structure.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">lengthable? </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachk </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">arr</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">values</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the values of an associative data structure.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">lengthable? </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">arr</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">pairs</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the key-value pairs of an associative data structure.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">lengthable? </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachp </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">arr</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">frequencies</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the number of occurrences of each value in an indexed data structure.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">freqs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">freqs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">freqs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">freqs</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">group-by</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Group elements of `ind` by a function `f` and put the results into a new table. The keys of</span>
<span class="s" title="Literal.String">  the table are the distinct return values from calling `f` on the elements of `ind`. The values</span>
<span class="s" title="Literal.String">  of the table are arrays of all elements of `ind` for which `f` called on the element equals</span>
<span class="s" title="Literal.String">  that corresponding key.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">arr</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">])))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">partition-by</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Partition elements of a sequential data structure by a representative function `f`. Partitions</span>
<span class="s" title="Literal.String">  split when `(f x)` changes values when iterating to the next element `x` of `ind`. Returns a new array</span>
<span class="s" title="Literal.String">  of arrays.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">span</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">category</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">is-new</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">      </span><span class="nv" title="Name.Variable">is-new</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">is-new</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">category</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">span</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">])</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">span</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">category</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">span</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">category</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">span</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">])</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">span</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">interleave</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns an array of the first elements of each col, then the second elements, etc.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cols</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mapcat </span><span class="nv" title="Name.Variable">tuple</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">cols</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">distinct</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Returns an array of the deduplicated values in `xs`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">seen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">seen</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">seen</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">flatten-into</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Takes a nested array (tree) `xs` and appends the depth first traversal of</span>
<span class="s" title="Literal.String">  `xs` to array `into`. Returns `into`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">into</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">indexed? </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flatten-into </span><span class="nv" title="Name.Variable">into</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">into</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">into</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">flatten</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Takes a nested array (tree) `xs` and returns the depth first traversal of</span>
<span class="s" title="Literal.String">  it. Returns a new array.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flatten-into </span><span class="p" title="Punctuation">@[]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">xs</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">kvs</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Takes a table or struct and returns and array of key value pairs</span>
<span class="s" title="Literal.String">  like `@[k v k v ...]`. Returns a new array.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">dict</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dict</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">from-pairs</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Takes a sequence of pairs and creates a table from each pair. It is the inverse of</span>
<span class="s" title="Literal.String">  `pairs` on a table. Returns a new table.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ps</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ps</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">interpose</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Returns a sequence of the elements of `ind` separated by</span>
<span class="s" title="Literal.String">  `sep`. Returns a new array.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">sep</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">lengthable? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">* </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sep</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)])</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sep</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">@[]))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">partition-slice</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">div </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/new-filled </span><span class="nv" title="Name.Variable">parts</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parts</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">partition</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Partition an indexed data structure `ind` into tuples</span>
<span class="s" title="Literal.String">  of size `n`. Returns a new array.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">indexed? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition</span><span class="nv" title="Name.Variable">-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tuple/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bytes? </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition</span><span class="nv" title="Name.Variable">-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">string/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition</span><span class="nv" title="Name.Variable">-slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tuple/slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">values </span><span class="nv" title="Name.Variable">ind</span><span class="p" title="Punctuation">))))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### IO Helpers</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">slurp</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Read all data from a file with name `path` and then close the file.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/open </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:rb</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;could not open file &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">contents</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/read </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:all</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/close </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">contents</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">spit</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Write `contents` to a file at `path`. Can optionally append to the file.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">contents</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">mode</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:wb</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/open </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;could not open file &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; with mode &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/write </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">contents</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/close </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*pretty-format*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Format specifier for the `pp` function&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">pp</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Pretty-print to stdout or `(dyn *out*)`. The format string used is `(dyn *pretty-format* &quot;%q&quot;)`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">printf </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*pretty-format*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;%q&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flush</span><span class="p" title="Punctuation">))</span>


<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">file/lines</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Return an iterator over the lines of a file.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">file</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">coro</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/read </span><span class="nv" title="Name.Variable">file</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:line</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">yield </span><span class="nv" title="Name.Variable">line</span><span class="p" title="Punctuation">))))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Pattern Matching</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">match</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  Pattern matching. Match an expression `x` against any number of cases.</span>
<span class="s" title="Literal.String">  Each case is a pattern to match against, followed by an expression to</span>
<span class="s" title="Literal.String">  evaluate to if that case is matched.  Legal patterns are:</span>

<span class="s" title="Literal.String">  * symbol -- a pattern that is a symbol will match anything, binding `x`&#39;s</span>
<span class="s" title="Literal.String">    value to that symbol.</span>

<span class="s" title="Literal.String">  * array or bracket tuple -- an array or bracket tuple will match only if</span>
<span class="s" title="Literal.String">    all of its elements match the corresponding elements in `x`.</span>
<span class="s" title="Literal.String">    Use `&amp; rest` at the end of an array or bracketed tuple to bind all remaining values to `rest`.</span>

<span class="s" title="Literal.String">  * table or struct -- a table or struct will match if all values match with</span>
<span class="s" title="Literal.String">    the corresponding values in `x`.</span>

<span class="s" title="Literal.String">  * tuple -- a tuple pattern will match if its first element matches, and the</span>
<span class="s" title="Literal.String">    following elements are treated as predicates and are true.</span>

<span class="s" title="Literal.String">  * `_` symbol -- the last special case is the `_` symbol, which is a wildcard</span>
<span class="s" title="Literal.String">    that will match any value without creating a binding.</span>

<span class="s" title="Literal.String">  While a symbol pattern will ordinarily match any value, the pattern `(@ &lt;sym&gt;)`,</span>
<span class="s" title="Literal.String">  where &lt;sym&gt; is any symbol, will attempt to match `x` against a value</span>
<span class="s" title="Literal.String">  already bound to `&lt;sym&gt;`, rather than matching and rebinding it.</span>

<span class="s" title="Literal.String">  Any other value pattern will only match if it is equal to `x`.</span>
<span class="s" title="Literal.String">  Quoting a pattern with `&#39;` will also treat the value as a literal value to match against.</span>

<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cases</span><span class="p" title="Punctuation">]</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Partition body into sections.</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">oddlen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">odd? </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">cases</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">else</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">oddlen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="nv" title="Name.Variable">cases</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">patterns</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">oddlen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slice </span><span class="nv" title="Name.Variable">cases</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cases</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Keep an array for accumulating the compilation output</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">x-sym</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">idempotent? </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x-sym</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Table of gensyms</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">symbols</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{[</span><span class="k k-Constants" title="Keyword.Constants">nil nil</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x-sym</span><span class="p" title="Punctuation">})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">length-symbols</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">emit</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">emit-branch</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">result</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">accum</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:branch</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">result</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">get-sym</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">symbol-key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">symbol-key</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">symbol-key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">get</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">]])</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">get-length-sym</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">parent-sym</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">length-symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">length-symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">indexed?</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">length</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="p" title="Punctuation">]]])</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">visit-pattern-1</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">_</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">isarr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:array</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/type </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:brackets</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>

<span class="nb" title="Name.Builtin">      </span><span class="c1" title="Comment.Single"># match local binding</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:symbol</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">]))</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match quoted literal</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">quote</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match data structure template</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:struct</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:table</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachp </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">isarr</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-length-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachp </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">inc </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">errorf </span><span class="s" title="Literal.String">&quot;expected symbol following &amp; in pattern&quot;</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">errorf </span><span class="s" title="Literal.String">&quot;expected a single symbol follow &#39;&amp; in pattern, found %q&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slice </span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">inc </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">inc </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:symbol</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">errorf </span><span class="s" title="Literal.String">&quot;expected symbol following &amp; in pattern, found %q&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">inc </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">inc </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[[</span><span class="nv" title="Name.Variable">slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]])</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match global unification</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">@</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match predicated binding</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">visit-pattern-2</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">preds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">_</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">isarr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:array</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/type </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:brackets</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">isarr</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-length-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">pattern-len</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rest-idx</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find-index </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">rest-idx</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&lt;=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern-len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-length-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>

<span class="nb" title="Name.Builtin">      </span><span class="c1" title="Comment.Single"># match data structure template</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:struct</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:table</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachp </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">not=</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)])</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">preds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">isarr</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachp </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span>
<span class="w" title="Text.Whitespace">        </span><span class="c1" title="Comment.Single"># stop recursing to sub-patterns if the rest sigil is found</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">preds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sub-pattern</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match local binding</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:symbol</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match quoted literal</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">quote</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">])</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match global unification</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">@</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">]))</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match predicated binding</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:tuple</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">preds</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slice </span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">preds</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent-sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># match literal</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">])))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Compile the patterns</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pattern</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expression</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">patterns</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">preds</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b2g</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil nil </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">and</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">visit-pattern-2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">gun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">preds</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil nil </span><span class="nv" title="Name.Variable">pattern</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># Local unification</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">unify</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">syms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b2g</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">syms</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">unify</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">syms</span><span class="p" title="Punctuation">])))</span>
<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># Global unification</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachp </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">syms</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">gun</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">unify</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">=</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">binding</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">syms</span><span class="p" title="Punctuation">]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort </span><span class="nv" title="Name.Variable">unify</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">unify</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># Final binding</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">defs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">pairs </span><span class="nv" title="Name.Variable">b2g</span><span class="p" title="Punctuation">))]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">first </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># Predicates</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">empty? </span><span class="nv" title="Name.Variable">preds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">pred-join</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">defs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">preds</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">anda</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred-join</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-branch</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">anda</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">do</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">defs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expression</span><span class="p" title="Punctuation">]))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Expand branches</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">else</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reverse </span><span class="nv" title="Name.Variable">accum</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:branch</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">el</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/pop </span><span class="nv" title="Name.Variable">stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="nv" title="Name.Variable">truthy</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/pop </span><span class="nv" title="Name.Variable">stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="nv" title="Name.Variable">if-form</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">condition</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">truthy</span>
<span class="w" title="Text.Whitespace">                       </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                          </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span>
<span class="k k-Constants" title="Keyword.Constants">                          </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                          </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reverse </span><span class="nv" title="Name.Variable">stack</span><span class="p" title="Punctuation">))))]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/remove </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">stack</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">if-form</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">el</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">reverse </span><span class="nv" title="Name.Variable">stack</span><span class="p" title="Punctuation">)))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Macro Expansion</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*macro-lints*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Bound to an array of lint messages that will be reported by the compiler inside a macro.</span>
<span class="s" title="Literal.String">  To indicate an error or warning, a macro author should use `maclintf`.``</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">maclintf</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``When inside a macro, call this function to add a linter warning. Takes</span>
<span class="s" title="Literal.String">  a `fmt` argument like `string/format`, which is used to format the message.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fmt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lints</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*macro-lints*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">lints</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*macro-form*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple? </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/sourcemap </span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="k k-Constants" title="Keyword.Constants">nil nil</span><span class="p" title="Punctuation">]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="mf" title="Literal.Number.Float">-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">msg</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/format </span><span class="nv" title="Name.Variable">fmt</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">lints</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">msg</span><span class="p" title="Punctuation">]))</span>
<span class="w" title="Text.Whitespace">  </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">macex1</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Expand macros in a form, but do not recursively expand macros.</span>
<span class="s" title="Literal.String">  See `macex` docs for info on `on-binding`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-binding</span><span class="p" title="Punctuation">]</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">on-binding</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol? </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">on-binding</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">macex1 </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-binding</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">dotable</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-value</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">newt</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">newt</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">on-value</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">key</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">key</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">newt</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">expand-bindings</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">expand-bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">expand-bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dotable</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expand-bindings</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/to-struct </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dotable</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expand-bindings</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">expanddef</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">last</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">bound</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice</span>
<span class="nb" title="Name.Builtin">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat</span>
<span class="nb" title="Name.Builtin">        </span><span class="p" title="Punctuation">@[(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">expand-bindings</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bound</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">@[(</span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last</span><span class="p" title="Punctuation">)])))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">expandall</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">expandfn</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">t1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol? </span><span class="nv" title="Name.Variable">t1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">3</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">fn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">fn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t1</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">expandqq</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">qq</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:brackets</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">qq</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                   </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">x0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                   </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">unquote</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">x0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">qq</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">qq</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">qq</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">kvs </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">struct </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">qq</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">kvs </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">qq</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">specs</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">{</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">set</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expanddef</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expanddef</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">do</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expandall</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">fn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expandfn</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expandall</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">quote</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">identity</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">quasiquote</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expandqq</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">var</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expanddef</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">while</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expandall</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">break</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expandall</span>
<span class="w" title="Text.Whitespace">     </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">upscope</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expandall</span><span class="p" title="Punctuation">})</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">dotup</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">specs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">h</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">h</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">{}))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ref</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:value</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">m?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:macro</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">      </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">m?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*macro-form*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:brackets</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/brackets </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dotup</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">recur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/to-struct </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dotable</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">recur</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dotable</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">recur</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">all</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Returns true if `(pred item)` is truthy for every item in `ind`.</span>
<span class="s" title="Literal.String">  Otherwise, returns the first falsey result encountered.</span>
<span class="s" title="Literal.String">  Returns true if `ind` is empty.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:all</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">some</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Returns nil if `(pred item)` is false or nil for every item in `ind`.</span>
<span class="s" title="Literal.String">  Otherwise, returns the first truthy result encountered.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map</span><span class="nv" title="Name.Variable">-template</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:some</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">inds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">deep-not=</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Like `not=`, but mutable types (arrays, tables, buffers) are considered</span>
<span class="s" title="Literal.String">  equal if they have identical structure. Much slower than `not=`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">tx</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">tx</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">tx</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                   </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                   </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">xx</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">yy</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">deep-not= </span><span class="nv" title="Name.Variable">xx</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">yy</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">                   </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                   </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                   </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">xx</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">yy</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">deep-not= </span><span class="nv" title="Name.Variable">xx</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">yy</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">                   </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">deep-not= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">kvs </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">kvs </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">deep-not= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/to-struct </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/to-struct </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:buffer</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">deep=</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Like `=`, but mutable types (arrays, tables, buffers) are considered</span>
<span class="s" title="Literal.String">  equal if they have identical structure. Much slower than `=`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">deep-not= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">freeze</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Freeze an object (make it immutable) and do a deep copy, making</span>
<span class="s" title="Literal.String">  child values also immutable. Closures, fibers, and abstract types</span>
<span class="s" title="Literal.String">  will not be recursively frozen, but all other types will.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">freeze</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">freeze</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/getproto </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">             </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">freeze </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">merge </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/clone </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">             </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">struct </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">freeze</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">kvs </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">struct </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">freeze</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">kvs </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:buffer</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">thaw</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Thaw an object (make it mutable) and do a deep copy, making</span>
<span class="s" title="Literal.String">  child value also mutable. Closures, fibers, and abstract</span>
<span class="s" title="Literal.String">  types will not be recursively thawed, but all other types will`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:array</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">thaw</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:tuple</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-ind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">thaw</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:table</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">thaw</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/proto-flatten </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:struct</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">walk</span><span class="nv" title="Name.Variable">-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">thaw</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">struct/proto-flatten </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:string</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">ds</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">macex</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Expand macros completely.</span>
<span class="s" title="Literal.String">  `on-binding` is an optional callback for whenever a normal symbolic binding</span>
<span class="s" title="Literal.String">  is encountered. This allows macros to easily see all bindings used by their</span>
<span class="s" title="Literal.String">  arguments by calling `macex` on their contents. The binding itself is also</span>
<span class="s" title="Literal.String">  replaced by the value returned by `on-binding` within the expanded macro.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-binding</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">previous</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">current</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">macex1 </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-binding</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">counter</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">deep-not= </span><span class="nv" title="Name.Variable">current</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">previous</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">counter</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">200</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;macro expansion too nested&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">previous</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">current</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">current</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">macex1 </span><span class="nv" title="Name.Variable">current</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-binding</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">current</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">varfn</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Create a function that can be rebound. `varfn` has the same signature</span>
<span class="s" title="Literal.String">  as `defn`, but defines functions in the environment as vars. If a var `name`</span>
<span class="s" title="Literal.String">  already exists in the environment, it is rebound to the new function. Returns</span>
<span class="s" title="Literal.String">  a function.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">expansion</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">apply </span><span class="nv" title="Name.Variable">defn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fbody</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="nv" title="Name.Variable">expansion</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">modifiers</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">expansion</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">metadata</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">modifiers</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keyword? </span><span class="nv" title="Name.Variable">m</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">metadata</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="nv" title="Name.Variable">m</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">metadata</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:doc</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">m</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;invalid metadata &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">m</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">old-entry</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">old-entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">dyn</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;,</span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">old-entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:ref</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">]}))</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">setdyn</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">entry</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fbody</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">put-in</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="no" title="Name.Constant">:ref</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">merge-into</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;,</span><span class="nv" title="Name.Variable">metadata</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">       </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Function shorthand</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">short-fn</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  Shorthand for `fn`. Arguments are given as `$n`, where `n` is the 0-indexed</span>
<span class="s" title="Literal.String">  argument of the function. `$` is also an alias for the first (index 0) argument.</span>
<span class="s" title="Literal.String">  The `$&amp;` symbol will make the anonymous function variadic if it appears in the</span>
<span class="s" title="Literal.String">  body of the function, and can be combined with positional arguments.</span>

<span class="s" title="Literal.String">  Example usage:</span>

<span class="s" title="Literal.String">      (short-fn (+ $ $)) # A function that doubles its arguments.</span>
<span class="s" title="Literal.String">      (short-fn (string $0 $1)) # accepting multiple args.</span>
<span class="s" title="Literal.String">      |(+ $ $) # use pipe reader macro for terse function literals.</span>
<span class="s" title="Literal.String">      |(+ $&amp;)  # variadic functions</span>
<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">arg</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">max-param-seen</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">vararg</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">saw-special-arg</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">num</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">max-param-seen</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">max </span><span class="nv" title="Name.Variable">max-param-seen</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">num</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">on-binding</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">$</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">$</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">saw-special-arg</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">$0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">$&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">vararg</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:else</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">num</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">scan-number </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">nat? </span><span class="nv" title="Name.Variable">num</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">saw-special-arg</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">num</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">expanded</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">macex </span><span class="nv" title="Name.Variable">arg</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-binding</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">name-splice</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fn-args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">max-param-seen</span><span class="p" title="Punctuation">)]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">$</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">name-splice</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">fn-args</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">vararg</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">$&amp;</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[])]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">expanded</span><span class="p" title="Punctuation">))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Default PEG patterns</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*peg-grammar*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``The implicit base grammar used when compiling PEGs. Any undefined keywords</span>
<span class="s" title="Literal.String">  found when compiling a peg will use lookup in this table (if defined).``</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">default-peg-grammar</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`The default grammar used for pegs. This grammar defines several common patterns</span>
<span class="s" title="Literal.String">  that should make it easier to write more complex patterns.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:a</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range </span><span class="s" title="Literal.String">&quot;az&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;AZ&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:d</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range </span><span class="s" title="Literal.String">&quot;09&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:h</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range </span><span class="s" title="Literal.String">&quot;09&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;af&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;AF&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="s" title="Literal.String">&quot; \t\r\n\0\f\v&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:w</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">range </span><span class="s" title="Literal.String">&quot;az&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;AZ&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;09&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:A</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="no" title="Name.Constant">:a</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:D</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="no" title="Name.Constant">:d</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:H</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="no" title="Name.Constant">:h</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:S</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="no" title="Name.Constant">:s</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:W</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="no" title="Name.Constant">:w</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:a+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:a</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:d+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:d</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:h+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:h</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:s+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:w+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:w</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:A+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:A</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:D+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:D</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:H+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:H</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:S+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:S</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:W+</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">some </span><span class="no" title="Name.Constant">:W</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:a*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:a</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:d*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:d</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:h*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:h</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:s*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:s</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:w*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:w</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:A*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:A</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:D*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:D</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:H*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:H</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:S*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:S</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:W*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">any</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:W</span><span class="p" title="Punctuation">)})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*peg-grammar*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">default-peg-grammar</span><span class="p" title="Punctuation">)</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Evaluation and Compilation</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*syspath*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Path of directory to load system modules from.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="c1" title="Comment.Single"># Initialize syspath</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">boot/args</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="nv" title="Name.Variable">k</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;JANET_PATH&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*syspath*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">make-env</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Create a new environment table. The new environment</span>
<span class="s" title="Literal.String">  will inherit bindings from the parent environment, but new</span>
<span class="s" title="Literal.String">  bindings will not pollute the parent environment.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">parent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">parent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">root-env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">newenv</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/setproto </span><span class="p" title="Punctuation">@{}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">newenv</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*err-color*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Whether or not to turn on error coloring in stacktraces and other error messages.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">bad-parse</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Default handler for a parse error.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ec</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*err-color*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">ec</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[31m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">where</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;:&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">line</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;:&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">col</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;: parse error: &quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">ec</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[0m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eflush</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">print-line-col</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Print the source code at a line, column in a source file. If unable to open</span>
<span class="s" title="Literal.String">  the file, prints nothing.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-with </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/open </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:r</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">source-code</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/read </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:all</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">repeat </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dec </span><span class="nv" title="Name.Variable">line</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/find </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source-code</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">index</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">index</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">index</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">line-end</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/find </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source-code</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">index</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;  &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">source-code</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line-end</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">col</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">index</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/repeat </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">inc </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;^&quot;</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">warn-compile</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Default handler for a compile warning.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">msg</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ec</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*err-color*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">ec</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[33m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">where</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;:&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">line</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;:&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">col</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;: compile warning (&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;): &quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="nv" title="Name.Variable">msg</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">ec</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-line-col</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin </span><span class="s" title="Literal.String">&quot;\e[0m&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eflush</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">bad-compile</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Default handler for a compile error.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">msg</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">macrof</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ec</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*err-color*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">ec</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[31m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">where</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;:&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">line</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;:&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">col</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;: compile error: &quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">macrof</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/stacktrace </span><span class="nv" title="Name.Variable">macrof</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">msg</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="nv" title="Name.Variable">msg</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">ec</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-line-col</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin </span><span class="s" title="Literal.String">&quot;\e[0m&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eflush</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">curenv</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Get the current environment table. Same as `(fiber/getenv (fiber/current))`. If `n`</span>
<span class="s" title="Literal.String">  is provided, gets the nth prototype of the environment table.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/getenv </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/current</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">repeat </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/getproto </span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">def- </span><span class="nv" title="Name.Variable">lint-levels</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:none</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span>
<span class="w" title="Text.Whitespace">   </span><span class="no" title="Name.Constant">:relaxed</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span>
<span class="w" title="Text.Whitespace">   </span><span class="no" title="Name.Constant">:normal</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span>
<span class="w" title="Text.Whitespace">   </span><span class="no" title="Name.Constant">:strict</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">3</span>
<span class="w" title="Text.Whitespace">   </span><span class="no" title="Name.Constant">:all</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">math/inf</span><span class="p" title="Punctuation">})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">run-context</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  Run a context. This evaluates expressions in an environment,</span>
<span class="s" title="Literal.String">  and encapsulates the parsing, compilation, and evaluation.</span>
<span class="s" title="Literal.String">  Returns `(in environment :exit-value environment)` when complete.</span>
<span class="s" title="Literal.String">  `opts` is a table or struct of options. The options are as follows:</span>

<span class="s" title="Literal.String">    * `:chunks` -- callback to read into a buffer - default is getline</span>

<span class="s" title="Literal.String">    * `:on-parse-error` -- callback when parsing fails - default is bad-parse</span>

<span class="s" title="Literal.String">    * `:env` -- the environment to compile against - default is the current env</span>

<span class="s" title="Literal.String">    * `:source` -- source path for better errors (use keywords for non-paths) - default</span>
<span class="s" title="Literal.String">      is :&lt;anonymous&gt;</span>

<span class="s" title="Literal.String">    * `:on-compile-error` -- callback when compilation fails - default is bad-compile</span>

<span class="s" title="Literal.String">    * `:on-compile-warning` -- callback for any linting error - default is warn-compile</span>

<span class="s" title="Literal.String">    * `:evaluator` -- callback that executes thunks. Signature is (evaluator thunk source</span>
<span class="s" title="Literal.String">      env where)</span>

<span class="s" title="Literal.String">    * `:on-status` -- callback when a value is evaluated - default is debug/stacktrace.</span>

<span class="s" title="Literal.String">    * `:fiber-flags` -- what flags to wrap the compilation fiber with. Default is :ia.</span>

<span class="s" title="Literal.String">    * `:expander` -- an optional function that is called on each top level form before</span>
<span class="s" title="Literal.String">      being compiled.</span>

<span class="s" title="Literal.String">    * `:parser` -- provide a custom parser that implements the same interface as Janet&#39;s</span>
<span class="s" title="Literal.String">      built-in parser.</span>

<span class="s" title="Literal.String">    * `:read` -- optional function to get the next form, called like `(read env source)`.</span>
<span class="s" title="Literal.String">      Overrides all parsing.</span>
<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">opts</span><span class="p" title="Punctuation">]</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:chunks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chunks</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:on-status</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">onstatus</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:on-compile-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-compile-error</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:on-compile-warning</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-compile-warning</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:on-parse-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">on-parse-error</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:fiber-flags</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">guard</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">evaluator</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">default-where</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:parser</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parser</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:read</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">read</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:expander</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expand</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">opts</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/getenv </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/current</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{}))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">chunks</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">getline </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">onstatus</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">debug/stacktrace</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">on-compile-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bad-compile</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">on-compile-warning</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">warn-compile</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">on-parse-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bad-parse</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">evaluate</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">default-where</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:&lt;anonymous&gt;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">guard</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ydt</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">default-where</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*current-file*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Evaluate 1 source form in a protected manner</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lints</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">eval1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">expand</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">expand</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">good</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">resumeval</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/new</span>
<span class="nb" title="Name.Builtin">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/clear </span><span class="nv" title="Name.Variable">lints</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compile </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lints</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">empty? </span><span class="nv" title="Name.Variable">lints</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="c1" title="Comment.Single"># Convert lint levels to numbers.</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">levels</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*lint-levels*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lint-levels</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lint-error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*lint-error*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lint-warning</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*lint-warn*</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lint-error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">levels</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lint-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lint-error</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lint-warning</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">levels</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lint-warning</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lint-warning</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">msg</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lints</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lvl</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">lint-levels</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">                </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="nv" title="Name.Variable">lvl</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lint-error</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                                      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">good</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">on-compile-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">msg</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">col</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">                </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="nv" title="Name.Variable">lvl</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lint-warning</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">on-compile-warning</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">msg</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">col</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">good</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval</span><span class="nv" title="Name.Variable">uator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">good</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">err</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:column</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">column</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:fiber</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">errf</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">on-compile-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">err</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">errf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">column</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">))))))</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">guard</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/can-resume? </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">resume </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">resumeval</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">good</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">resumeval</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">onstatus</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Reader version</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">read</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forever</span>
<span class="nb" title="Name.Builtin">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval</span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">read</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">break </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit-value</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># The parser object</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">parser</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/new</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">p-consume</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:consume</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">p-produce</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:produce</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">p-status</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:status</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">p-has-more</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:has-more</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">parse-err</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Handle parser error in the correct environment&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">coro </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">on-parse-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/setenv </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">resume </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">produce</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">tup</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p-produce</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">tup</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/sourcemap </span><span class="nv" title="Name.Variable">tup</span><span class="p" title="Punctuation">)])</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Loop</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">@&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">parser-not-done</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="nv" title="Name.Variable">parser-not-done</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/clear </span><span class="nv" title="Name.Variable">buf</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">match </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">chunks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="no" title="Name.Constant">:cancel</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="c1" title="Comment.Single"># A :cancel chunk represents a cancelled form in the REPL, so reset.</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:flush</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/clear </span><span class="nv" title="Name.Variable">buf</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">[</span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-where</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-where</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="nv" title="Name.Variable">new-where</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*current-file*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-where</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">pindex</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">pstatus</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">buf</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:eof</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">parser-not-done</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pindex</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">pindex</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p-consume</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pindex</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p-has-more</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval</span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">produce</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p-status</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:error</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-err</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Check final parser state</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p-has-more</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval</span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">produce</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p-status</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:error</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-err</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit-value</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">quit</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Tries to exit from the current repl or run-context. Does not always exit the application.</span>
<span class="s" title="Literal.String">  Works by setting the :exit dynamic binding to true. Passing a non-nil `value` here will cause the outer</span>
<span class="s" title="Literal.String">  run-context to return that value.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="no" title="Name.Constant">:exit-value</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">eval</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Evaluates a form in the current environment. If more control over the</span>
<span class="s" title="Literal.String">  environment is needed, use `run-context`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">form</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compile </span><span class="nv" title="Name.Variable">form</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="no" title="Name.Constant">:eval</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:error</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">parse</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Parse a string and return the first value. For complex parsing, such as for a repl with error handling,</span>
<span class="s" title="Literal.String">  use the parser api.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">str</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/new</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/consume </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">str</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/status </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/error </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/eof </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/has-more </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/produce </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/status </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/error </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="s" title="Literal.String">&quot;no value&quot;</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">parse-all</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Parse a string and return all parsed values. For complex parsing, such as for a repl with error handling,</span>
<span class="s" title="Literal.String">  use the parser api.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">str</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/new</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[]]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/consume </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">str</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/status </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/error </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/eof </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/has-more </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/produce </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/status </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/error </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">eval-string</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Evaluates a string in the current environment. If more control over the</span>
<span class="s" title="Literal.String">  environment is needed, use `run-context`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">str</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse-all </span><span class="nv" title="Name.Variable">str</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">load-image-dict</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``A table used in combination with `unmarshal` to unmarshal byte sequences created</span>
<span class="s" title="Literal.String">  by `make-image`, such that `(load-image bytes)` is the same as `(unmarshal bytes load-image-dict)`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">@{})</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">make-image-dict</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``A table used in combination with `marshal` to marshal code (images), such that</span>
<span class="s" title="Literal.String">  `(make-image x)` is the same as `(marshal x make-image-dict)`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">@{})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">comptime</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Evals x at compile time and returns the result. Similar to a top level unquote.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">compif</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Check the condition `cnd` at compile time -- if truthy, compile `tru`, else compile `fals`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">cnd</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">tru</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fals</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval </span><span class="nv" title="Name.Variable">cnd</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">tru</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">fals</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">compwhen</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Check the condition `cnd` at compile time -- if truthy, compile `(upscope ;body)`, else compile nil.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">cnd</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval </span><span class="nv" title="Name.Variable">cnd</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">upscope </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">make-image</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Create an image from an environment returned by `require`.</span>
<span class="s" title="Literal.String">  Returns the image source as a string.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">marshal </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">make-image-dict</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">load-image</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;The inverse operation to `make-image`. Returns an environment.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">image</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unmarshal </span><span class="nv" title="Name.Variable">image</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">load-image-dict</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">check-dyn-relative</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;@&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">check-relative</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">check-not-relative</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">check-is-dep</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;@&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">check-project-relative</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">module/cache</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;A table, mapping loaded module identifiers to their environments.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">@{})</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">module/paths</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  The list of paths to look for modules, templated for `module/expand-path`.</span>
<span class="s" title="Literal.String">  Each element is a two-element tuple, containing the path</span>
<span class="s" title="Literal.String">  template and a keyword :source, :native, or :image indicating how</span>
<span class="s" title="Literal.String">  `require` should load files found at these paths.</span>

<span class="s" title="Literal.String">  A tuple can also</span>
<span class="s" title="Literal.String">  contain a third element, specifying a filter that prevents `module/find`</span>
<span class="s" title="Literal.String">  from searching that path template if the filter doesn&#39;t match the input</span>
<span class="s" title="Literal.String">  path. The filter can be a string or a predicate function, and</span>
<span class="s" title="Literal.String">  is often a file extension, including the period.</span>
<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">@[])</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">module/add-paths</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  Add paths to `module/paths` for a given loader such that</span>
<span class="s" title="Literal.String">  the generated paths behave like other module types, including</span>
<span class="s" title="Literal.String">  relative imports and syspath imports. `ext` is the file extension</span>
<span class="s" title="Literal.String">  to associate with this module type, including the dot. `loader` is the</span>
<span class="s" title="Literal.String">  keyword name of a loader in `module/loaders`. Returns the modified `module/paths`.</span>
<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ext</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">loader</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">find-prefix</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pre</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find-index </span><span class="o" title="Operator">|</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">$</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="nv" title="Name.Variable">pre</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">$</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">module/paths</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">dyn-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find</span><span class="nv" title="Name.Variable">-prefix</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;:@all:&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/insert </span><span class="nv" title="Name.Variable">module/paths</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">dyn-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;:@all:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ext</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">loader</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">check-dyn-relative</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">all-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find</span><span class="nv" title="Name.Variable">-prefix</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;.:all:&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/insert </span><span class="nv" title="Name.Variable">module/paths</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">all-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;.:all:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ext</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">loader</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">check-project-relative</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sys-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find</span><span class="nv" title="Name.Variable">-prefix</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;:sys:&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/insert </span><span class="nv" title="Name.Variable">module/paths</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sys-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;:sys:/:all:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ext</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">loader</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">check-is-dep</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">curall-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">find</span><span class="nv" title="Name.Variable">-prefix</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;:cur:/:all:&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/insert </span><span class="nv" title="Name.Variable">module/paths</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">curall-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;:cur:/:all:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ext</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">loader</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">check-relative</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">module/paths</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/add-paths </span><span class="s" title="Literal.String">&quot;:native:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:native</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/add-paths </span><span class="s" title="Literal.String">&quot;/init.janet&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/add-paths </span><span class="s" title="Literal.String">&quot;.janet&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/add-paths </span><span class="s" title="Literal.String">&quot;.jimage&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:image</span><span class="p" title="Punctuation">)</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/insert </span><span class="nv" title="Name.Variable">module/paths</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">is-cached</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">module/cache</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:preload</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">check-not-relative</span><span class="p" title="Punctuation">])</span>

<span class="c1" title="Comment.Single"># Version of fexists that works even with a reduced OS</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">fexists</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compif </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">os/stat</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:file</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/stat </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:mode</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/open </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:rb</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">res</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">try </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/read </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">([</span><span class="nv" title="Name.Variable">err</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/close </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">mod-filter</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:nil</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:string</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-suffix? </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">module/find</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">  Try to match a module or path name from the patterns in `module/paths`.</span>
<span class="s" title="Literal.String">  Returns a tuple (fullpath kind) where the kind is one of :source, :native,</span>
<span class="s" title="Literal.String">  or :image if the module is found, otherwise a tuple with nil followed by</span>
<span class="s" title="Literal.String">  an error message.</span>
<span class="s" title="Literal.String">  ```</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">checker</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">module/paths</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mod</span><span class="nv" title="Name.Variable">-filter</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">checker</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">function? </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/expand-path </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">fexists</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fullpath</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">expander</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">t</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">_</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chk</span><span class="p" title="Punctuation">]]</span>
<span class="w" title="Text.Whitespace">                     </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                       </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mod</span><span class="nv" title="Name.Variable">-filter</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chk</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/expand-path </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">t</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">paths</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">filter </span><span class="nv" title="Name.Variable">identity</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">expander</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">module/paths</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">str-parts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">interpose </span><span class="s" title="Literal.String">&quot;\n    &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">paths</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">[</span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;could not find module &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;:\n    &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">str-parts</span><span class="p" title="Punctuation">)])))</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">module/loading</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`A table, mapping currently loading modules to true. Used to prevent</span>
<span class="s" title="Literal.String">  circular dependencies.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">@{})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">module/value</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Given a module table, get the value bound to a symbol `sym`. If `private` is</span>
<span class="s" title="Literal.String">  truthy, will also resolve private module symbols. If no binding is found, will return</span>
<span class="s" title="Literal.String">  nil.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">module</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">private</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">module</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">entry</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:value</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ref</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:private</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">private</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array? </span><span class="nv" title="Name.Variable">r</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">r</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">debugger-env</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;An environment that contains dot prefixed functions for debugging.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">@{})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">var- </span><span class="nv" title="Name.Variable">debugger-on-status-var</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">debugger</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Run a repl-based debugger on a fiber. Optionally pass in a level</span>
<span class="s" title="Literal.String">  to differentiate nested debuggers.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fiber</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">nextenv</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">make-env </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/getenv </span><span class="nv" title="Name.Variable">fiber</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">nextenv</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:fiber</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fiber</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">nextenv</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:debug-level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">nextenv</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:signal</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/last-value </span><span class="nv" title="Name.Variable">fiber</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">merge-into </span><span class="nv" title="Name.Variable">nextenv</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">debugger-env</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">debugger-chunks</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">status</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:state</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:delimiters</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">((</span><span class="no" title="Name.Constant">:where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">prpt</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;debug[&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;]:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">status</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&gt; &quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">getline </span><span class="nv" title="Name.Variable">prpt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">nextenv</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;entering debug[&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;] - (quit) to exit&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flush</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">run-context</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:chunks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">debugger-chunks</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:on-status</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debugger-on-status</span><span class="nv" title="Name.Variable">-var</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">nextenv</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="no" title="Name.Constant">:env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">nextenv</span><span class="p" title="Punctuation">})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;exiting debug[&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;]&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flush</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">next</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:resume-value</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">debugger-on-status</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Create a function that can be passed to `run-context`&#39;s `:on-status`</span>
<span class="s" title="Literal.String">  argument that will drop into a debugger on errors. The debugger will</span>
<span class="s" title="Literal.String">  only start on abnormal signals if the env table has the `:debug` dyn</span>
<span class="s" title="Literal.String">  set to a truthy value.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-repl</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">level</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/status </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="no" title="Name.Constant">:dead</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">is-repl</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">_</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:value</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">})</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">pf</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*pretty-format*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;%q&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">try</span>
<span class="nb" title="Name.Builtin">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">printf </span><span class="nv" title="Name.Variable">pf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">([</span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprintf </span><span class="s" title="Literal.String">&quot;bad pretty format %v: %v&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eflush</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flush</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/stacktrace </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eflush</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:debug</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debugger </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">level</span><span class="p" title="Punctuation">))))))</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">debugger-on-status-var</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">debugger-on-status</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">dofile</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Evaluate a file, file path, or stream and return the resulting environment. :env, :expander,</span>
<span class="s" title="Literal.String">  :source, :evaluator, :read, and :parser are passed through to the underlying</span>
<span class="s" title="Literal.String">  `run-context` call. If `exit` is true, any top level errors will trigger a</span>
<span class="s" title="Literal.String">  call to `(os/exit 1)` after printing the error.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;named</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">exit</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expander</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">read</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parser</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="no" title="Name.Constant">:core/file</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span>
<span class="w" title="Text.Whitespace">           </span><span class="no" title="Name.Constant">:core/stream</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/open </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:rb</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">path-is-file</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">make-env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">spath</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">path-is-file</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">spath</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">exit-error</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">exit-fiber</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">chunks</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">_</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:read</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">4096</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">bp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">exit</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bad-parse </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/exit </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">@&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-dyns </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">*err*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*err-color*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bad-parse </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">exit-error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">bc</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">z</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">exit</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bad-compile </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">z</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/exit </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">@&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-dyns </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">*err*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*err-color*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">bad-compile </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">z</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">exit-error</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">exit-fiber</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="nv" title="Name.Variable">f</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;could not find file &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">nenv</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">run-context </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:chunks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chunks</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:on-parse-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bp</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:on-compile-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bc</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:on-status</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">                               </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/status </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:dead</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                 </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">exit</span>
<span class="w" title="Text.Whitespace">                                   </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/stacktrace </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                   </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eflush</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                   </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/exit </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:debug</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                   </span><span class="p" title="Punctuation">((</span><span class="nb" title="Name.Builtin">debugger-on-status </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                   </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                                     </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">exit-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                                     </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">exit-fiber</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">evaluator</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:expander</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">expander</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:read</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">read</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:parser</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parser</span>
<span class="w" title="Text.Whitespace">                  </span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">path-is-file</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:&lt;anonymous&gt;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">spath</span><span class="p" title="Punctuation">))}))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">path-is-file</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:close</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">exit-error</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">exit-fiber</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">propagate </span><span class="nv" title="Name.Variable">exit-error</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">exit-fiber</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="nv" title="Name.Variable">exit-error</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">nenv</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">module/loaders</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``A table of loading method names to loading functions.</span>
<span class="s" title="Literal.String">  This table lets `require` and `import` load many different kinds</span>
<span class="s" title="Literal.String">  of files as modules.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:native</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">native-loader</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">native </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">make-env</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">source-loader</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">module/loading</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defer </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">module/loading</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dofile </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:preload</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">preload-loader</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">               </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">module/cache</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">                 </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">function? </span><span class="nv" title="Name.Variable">m</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                   </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/cache </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">m</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                   </span><span class="nv" title="Name.Variable">m</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="no" title="Name.Constant">:image</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">image-loader</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">load-image </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slurp </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)))})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">require-1</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kargs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/find </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">check</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">kargs</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:fresh</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">module/cache</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fullpath</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">check</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/loading </span><span class="nv" title="Name.Variable">fullpath</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;circular dependency &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; detected&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">loader</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keyword? </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/loaders </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="nv" title="Name.Variable">loader</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;module type &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; unknown&quot;</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">loader</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">module/cache</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">require</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Require a module with the given name. Will search all of the paths in</span>
<span class="s" title="Literal.String">  `module/paths`. Returns the new environment</span>
<span class="s" title="Literal.String">  returned from compiling and running the file.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">require</span><span class="mf" title="Literal.Number.Float">-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">struct </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">merge-module</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Merge a module source into the `target` environment with a `prefix`, as with the `import` macro.</span>
<span class="s" title="Literal.String">  This lets users emulate the behavior of `import` with a custom module table.</span>
<span class="s" title="Literal.String">  If `export` is truthy, then merged functions are not marked as private. Returns</span>
<span class="s" title="Literal.String">  the modified target environment.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">target</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">export</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:when</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol? </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:when</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:private</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">newv</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/setproto </span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:private</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="nv" title="Name.Variable">export</span><span class="p" title="Punctuation">)}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">target</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">newv</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">target</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">import*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Function form of `import`. Same parameters, but the path</span>
<span class="s" title="Literal.String">  and other symbol parameters should be strings instead.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">curenv</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">kargs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:as</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">as</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:prefix</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">prefix</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:export</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ep</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kargs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">newenv</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">require</span><span class="mf" title="Literal.Number.Float">-1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kargs</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or</span>
<span class="nb" title="Name.Builtin">                </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="nv" title="Name.Variable">as</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">as</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                </span><span class="nv" title="Name.Variable">prefix</span>
<span class="w" title="Text.Whitespace">                </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/split </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">merge-module </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">newenv</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">prefix</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ep</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">import</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Import a module. First requires the module, and then merges its</span>
<span class="s" title="Literal.String">  symbols into the current environment, prepending a given prefix as needed.</span>
<span class="s" title="Literal.String">  (use the :as or :prefix option to set a prefix). If no prefix is provided,</span>
<span class="s" title="Literal.String">  use the name of the module as a prefix. One can also use &quot;`:export true`&quot;</span>
<span class="s" title="Literal.String">  to re-export the imported symbols. If &quot;`:exit true`&quot; is given as an argument,</span>
<span class="s" title="Literal.String">  any errors encountered at the top level in the module will cause `(os/exit 1)`</span>
<span class="s" title="Literal.String">  to be called. Dynamic bindings will NOT be imported. Use :fresh to bypass the</span>
<span class="s" title="Literal.String">  module cache.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ps</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">argm</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mapcat </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:as</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)])</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ps</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="nv" title="Name.Variable">import*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">argm</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">use</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Similar to `import`, but imported bindings are not prefixed with a module</span>
<span class="s" title="Literal.String">  identifier. Can also import multiple modules in one shot.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">modules</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="o" title="Operator">|~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">import*</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">$</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:prefix</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">modules</span><span class="p" title="Punctuation">)))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Documentation</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">env-walk</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">local</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/getenv </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/current</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">envs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">envs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/getproto </span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">local</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">ret-set</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">envi</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">envs</span>
<span class="w" title="Text.Whitespace">         </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">envi</span>
<span class="w" title="Text.Whitespace">         </span><span class="no" title="Name.Constant">:when</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">pred</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">ret-set</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">sort </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keys </span><span class="nv" title="Name.Variable">ret-set</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">all-bindings</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Get all symbols available in an environment. Defaults to the current</span>
<span class="s" title="Literal.String">  fiber&#39;s environment. If `local` is truthy, will not show inherited bindings</span>
<span class="s" title="Literal.String">  (from prototype tables).``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">local</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">env-walk</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">symbol?</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">local</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">all-dynamics</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Get all dynamic bindings in an environment. Defaults to the current</span>
<span class="s" title="Literal.String">  fiber&#39;s environment. If `local` is truthy, will not show inherited bindings</span>
<span class="s" title="Literal.String">  (from prototype tables).``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">local</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">env-walk</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">keyword?</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">local</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*doc-width*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Width in columns to print documentation printed with `doc-format`.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*doc-color*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Whether or not to colorize documentation printed with `doc-format`.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">doc-format</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Reformat a docstring to wrap a certain width. Docstrings can either be plaintext</span>
<span class="s" title="Literal.String">  or a subset of markdown. This allows a long single line of prose or formatted text to be</span>
<span class="s" title="Literal.String">  a well-formed docstring. Returns a buffer containing the formatted text.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">width</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">colorize</span><span class="p" title="Punctuation">]</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">4</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">max-width</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">width</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*doc-width*</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">80</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">8</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">has-color</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">colorize</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                   </span><span class="nv" title="Name.Variable">colorize</span>
<span class="w" title="Text.Whitespace">                   </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*doc-color*</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Terminal codes for emission/tokenization</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">delimiters</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">has-color</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:underline</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;\e[4m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[24m&quot;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">       </span><span class="no" title="Name.Constant">:code</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;\e[97m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[39m&quot;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">       </span><span class="no" title="Name.Constant">:italics</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;\e[4m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[24m&quot;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">       </span><span class="no" title="Name.Constant">:bold</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;\e[1m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[22m&quot;</span><span class="p" title="Punctuation">]}</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:underline</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;_&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;_&quot;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">       </span><span class="no" title="Name.Constant">:code</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;`&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;`&quot;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">       </span><span class="no" title="Name.Constant">:italics</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;*&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;*&quot;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">       </span><span class="no" title="Name.Constant">:bold</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;**&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;**&quot;</span><span class="p" title="Punctuation">]}))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">modes</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">toggle-mode</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">active</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">modes</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">delims</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">delimiters</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">modes</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mode</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="nv" title="Name.Variable">active</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">delims</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">active</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Parse state</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">cursor</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="c1" title="Comment.Single"># indexes into string for parsing</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span><span class="w" title="Text.Whitespace"> </span><span class="c1" title="Comment.Single"># return value for this block.</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Traversal helpers</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">c</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">cn</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">c++</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">c+=n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">ret</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">cursor</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># skip* functions return number of characters matched and advance the cursor.</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">skipwhite</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">cursor</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">skipline</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">y</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">))))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c++</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">cursor</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Detection helpers - return number of characters matched</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">ul?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">cn</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and</span>
<span class="nb" title="Name.Builtin">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">x1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;*&quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;-&quot;</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">ol?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">old</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;0&quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt;= </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;9&quot;</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c++</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">c1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">cn</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">cursor</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">old</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">c1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;.&quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">c2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">c*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">fcb?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;`&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">cn</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">cn</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">3</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">nl?</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Parse helper</span>
<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># parse-* functions push nodes to `stack`, and return</span>
<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># the indentation they leave the cursor on.</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">parse-blocks</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="c1" title="Comment.Single"># mutual recursion</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">getslice</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">from</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">to</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">to</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">min </span><span class="nv" title="Name.Variable">to</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">str</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">from</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">to</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">push</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">parse-list</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">bullet-check</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">initial</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">temp-stack</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="nv" title="Name.Variable">initial</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">old-stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">temp-stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">current-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="nv" title="Name.Variable">current-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">item-indent</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">bullet-check</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c+=n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipwhite</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="nv" title="Name.Variable">item-indent</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">current-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipwhite</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">item-stack</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item-stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">current-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-blocks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item-indent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">temp-stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">push</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">item-stack</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">old-stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">push</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">temp-stack</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">current-indent</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">add-codeblock</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">replace-chunk</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/repeat </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">push</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[</span><span class="no" title="Name.Constant">:cb</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/replace-all </span><span class="nv" title="Name.Variable">replace-chunk</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">))])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipline</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipwhite</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">parse-fcb</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c+=n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">3</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipline</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c+=n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">fcb?</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipline</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipwhite</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">add-codeblock</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">parse-icb</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">current-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipline</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">current-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipwhite</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">current-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">add-codeblock</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">tokenize-line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">line</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">tokens</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">token</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">@&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">token-length</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">delim</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">toggle</span><span class="nv" title="Name.Variable">-mode</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mode</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">has-color</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">token-length</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">d</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">token</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">d</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">endtoken</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">first </span><span class="nv" title="Name.Variable">token</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/push </span><span class="nv" title="Name.Variable">tokens</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">token</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">token-length</span><span class="p" title="Punctuation">]))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/clear </span><span class="nv" title="Name.Variable">token</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">token-length</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">line</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">endtoken</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;`&quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">delim</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:code</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mod</span><span class="nv" title="Name.Variable">es</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:code</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">`\`</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">token-length</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">token</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;_&quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">delim</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:underline</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;*&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;*&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">delim</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:bold</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">delim</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:italics</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">token-length</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">token</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">token-length</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">token</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">endtoken</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">tokens</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set</span>
<span class="k" title="Keyword">    </span><span class="nv" title="Name.Variable">parse-blocks</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">parse-blocks</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">p-start</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">p-end</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">p-line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="nv" title="Name.Variable">p-start</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">p-start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipline</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">p-end</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cursor</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipwhite</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">finish-p</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="nv" title="Name.Variable">p-start</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="nv" title="Name.Variable">p-end</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p-start</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">push</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">tokenize-line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">slice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p-start</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p-end</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">p-start</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">nl?</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">finish-p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">c++</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipwhite</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">ul?</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">finish-p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-list</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ul?</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ul</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-indent</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">ol?</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">finish-p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-list</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ol?</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ol</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-indent</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">fcb?</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">finish-p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-fcb</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-indent</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt;= </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">4</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">finish-p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">new-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-icb</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-indent</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">p-line</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">finish-p</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">new-indent</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Handle first line specially for defn, defmacro, etc.</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;(&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">skipline</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">first-line</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">str</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">cursor</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fl-open</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">has-color</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[97m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fl-close</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">has-color</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\e[39m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">push</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[[(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">fl-open</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">first-line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fl-close</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">first-line</span><span class="p" title="Punctuation">)]]))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse</span><span class="nv" title="Name.Variable">-blocks</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Emission state</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">@&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">current-column</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Emission</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">emit-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">delta</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">current-column</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">delta</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/repeat </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">delta</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">current-column</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">emit-nl</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">current-column</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">emit-word</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">word</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">last-byte</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="nv" title="Name.Variable">buf</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and</span>
<span class="nb" title="Name.Builtin">            </span><span class="nv" title="Name.Variable">last-byte</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">last-byte</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">last-byte</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">++ </span><span class="nv" title="Name.Variable">current-column</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">len</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">word</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="nv" title="Name.Variable">indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">current-column</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">max-width</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-nl</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">word</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">current-column</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">emit-code</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">code</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">replacement</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/repeat </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">4</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-indent</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">4</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">buffer/push </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/replace-all </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">replacement</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">code</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">chr </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="nv" title="Name.Variable">code</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">current-column</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-nl</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">emit-node</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple? </span><span class="nv" title="Name.Variable">el</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">rep</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/repeat </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">word</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">el</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-word</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/replace-all </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">rep</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">word</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="nv" title="Name.Variable">indent</span>
<span class="w" title="Text.Whitespace">            </span><span class="nv" title="Name.Variable">len</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-nl</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">case </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">first </span><span class="nv" title="Name.Variable">el</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:ul</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">el</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-word</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;* &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">subel</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-node</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">subel</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:ol</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">el</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&gt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-indent</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lab</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/format </span><span class="s" title="Literal.String">&quot;%d. &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-word</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lab</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">subel</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-node</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">subel</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">lab</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">        </span><span class="no" title="Name.Constant">:cb</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-code</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">stack</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-nl</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">emit-node</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">el</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">indent</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">buf</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">print-index</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Print bindings in the current environment given a filter function.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fltr</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">filter </span><span class="nv" title="Name.Variable">fltr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">all-bindings</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">dynamics</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">describe</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">filter </span><span class="nv" title="Name.Variable">fltr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">all-dynamics</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">doc-format </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;Bindings:\n\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/join </span><span class="nv" title="Name.Variable">bindings</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil nil false</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">doc-format </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;Dynamics:\n\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/join </span><span class="nv" title="Name.Variable">dynamics</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil nil false</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;\n    Use (doc sym) for more information on a binding.\n&quot;</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">print-module-entry</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">bind-type</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;    &quot;</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:redef</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ref</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ref</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="no" title="Name.Constant">:var</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; (&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ref</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;)&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:macro</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:macro</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:module</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="no" title="Name.Constant">:module</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; (&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:kind</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;)&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">type </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:value</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">            </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sm</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source-map</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:doc</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;\n\n&quot;</span>
<span class="w" title="Text.Whitespace">         </span><span class="nv" title="Name.Variable">bind-type</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sm</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;    &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot; on line &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;, column &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">col</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">sm</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">d</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">doc-format </span><span class="nv" title="Name.Variable">d</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\n    no documentation found.\n&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">print-special-form-entry</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;\n\n&quot;</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;    special form\n\n&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;    (&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; ...)\n\n&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;    See https://janet-lang.org/docs/specials.html\n\n&quot;</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">doc*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the documentation for a symbol in a given environment. Function form of `doc`.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">]</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string? </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-index</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/find </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">sym</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">index-of </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">break</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">do</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">if</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">quasiquote</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">quote</span>
<span class="w" title="Text.Whitespace">                            </span><span class="nv" title="Name.Variable">set</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">splice</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">unquote</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">upscope</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">var</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">while</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-special-form-entry</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">module/find </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">mod-env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">module/cache</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fullpath</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-module-entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:module</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">                                   </span><span class="no" title="Name.Constant">:kind</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">mod-kind</span>
<span class="w" title="Text.Whitespace">                                   </span><span class="no" title="Name.Constant">:source-map</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fullpath</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil nil</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">                                   </span><span class="no" title="Name.Constant">:doc</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">mod-env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:doc</span><span class="p" title="Punctuation">)})</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;symbol &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; not found.&quot;</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-module-entry</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># else</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-index</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">identity</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">doc</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Shows documentation for the given symbol, or can show a list of available bindings.</span>
<span class="s" title="Literal.String">  If `sym` is a symbol, will look for documentation for that symbol. If `sym` is a string</span>
<span class="s" title="Literal.String">  or is not provided, will show all lexical and dynamic bindings in the current environment</span>
<span class="s" title="Literal.String">  containing that string (all bindings will be shown if no string is given).``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">doc*</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;,</span><span class="nv" title="Name.Variable">sym</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">doc-of</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Searches all loaded modules in module/cache for a given binding and prints out its documentation.</span>
<span class="s" title="Literal.String">  This does a search by value instead of by name. Returns nil.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">found</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">module-set</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">root-env</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">module/cache</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">         </span><span class="nv" title="Name.Variable">module</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">module-set</span>
<span class="w" title="Text.Whitespace">         </span><span class="nv" title="Name.Variable">value</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">module</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">check</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">value</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ref</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">value</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:value</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">check</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="nv" title="Name.Variable">-module-entry</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">value</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">found</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">break</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">found</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;documentation for value &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; not found.&quot;</span><span class="p" title="Punctuation">)))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Debugger</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.fiber</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the current fiber being debugged.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="no" title="Name.Constant">:fiber</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.signal</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the current signal being debugged.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="no" title="Name.Constant">:signal</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.stack</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Print the current fiber stack.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-dyns </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">*err-color*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/stacktrace </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.fiber</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.signal</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.frame</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Show a stack frame&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/stack </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.fiber</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">stack</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.locals</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Show local bindings&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:locals</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.fn</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the current function.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.slots</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get an array of slots in a stack frame.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:slots</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.slot</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Get the value of the nth slot.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">nth</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">frame-idx</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.slots</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">frame-idx</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">nth</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)))</span>

<span class="c1" title="Comment.Single"># Conditional compilation for disasm</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compwhen </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">disasm</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.disasm</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Gets the assembly for the current function.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">func</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">disasm </span><span class="nv" title="Name.Variable">func</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.bytecode</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Get the bytecode for the current function.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">((</span><span class="nv" title="Name.Variable">.disasm</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:bytecode</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.ppasm</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Pretty prints the assembly for the current function.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">func</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">dasm</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">disasm </span><span class="nv" title="Name.Variable">func</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">bytecode</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">dasm</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:bytecode</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">pc</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pc</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">sourcemap</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">dasm</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:sourcemap</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">last-loc</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">-2</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">])</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;\n  signal:     &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.signal</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;  status:     &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/status </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.fiber</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;  function:   &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">dasm</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:name</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&lt;anonymous&gt;&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; [&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">dasm</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;]&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">constants</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dasm</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:constants</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprintf </span><span class="s" title="Literal.String">&quot;  constants:  %.4q&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">constants</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprintf </span><span class="s" title="Literal.String">&quot;  slots:      %.4q\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:slots</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">src-path</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">dasm</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">fexists</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">src-path</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                 </span><span class="nv" title="Name.Variable">sourcemap</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">dump</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">src</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cur</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">offset</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">5</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">beg</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">max </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">- </span><span class="nv" title="Name.Variable">cur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">offset</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lines</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/concat </span><span class="p" title="Punctuation">@[</span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/split </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">end</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">min </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">cur</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">offset</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">lines</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">digits</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">inc </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">math/floor </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">math/log10 </span><span class="nv" title="Name.Variable">end</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fmt-str</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;%&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">digits</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;d: %s&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">for </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">beg</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">end</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="c1" title="Comment.Single"># breakpoint someday?</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">cur</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&gt; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;  &quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprintf </span><span class="nv" title="Name.Variable">fmt-str</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">lines</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">sl</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">_</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">sourcemap</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pc</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dump</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slurp </span><span class="nv" title="Name.Variable">src-path</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sl</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">padding</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/repeat </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">20</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:range</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bytecode</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">           </span><span class="no" title="Name.Constant">:let</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">instr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">bytecode</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)]]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/type </span><span class="nv" title="Name.Variable">instr</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:brackets</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;*&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pc</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&gt; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;  &quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprinf </span><span class="s" title="Literal.String">&quot;%.20s&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/join </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="nv" title="Name.Variable">string</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">instr</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">padding</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">sourcemap</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">sl</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sc</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">sourcemap</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="nv" title="Name.Variable">loc</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">sl</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sc</span><span class="p" title="Punctuation">]]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="nv" title="Name.Variable">loc</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">last-loc</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">last-loc</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">loc</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprin </span><span class="s" title="Literal.String">&quot; # line &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sl</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;, column &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">sc</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.breakall</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Set breakpoints on all instructions in the current function.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.fn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">bytecode</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.bytecode</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bytecode</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/fbreak </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;set &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bytecode</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; breakpoints in &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fun</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.clearall</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Clear all breakpoints on the current function.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.fn</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">bytecode</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.bytecode</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bytecode</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/unfbreak </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;cleared &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">bytecode</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; breakpoints in &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fun</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.source</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Show the source code for the function being debugged.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">all-source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slurp </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">all-source</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\n&quot;</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.break</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Set breakpoint at the current pc.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">pc</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pc</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/fbreak </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pc</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;set breakpoint in &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; at pc=&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pc</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.clear</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Clear the current breakpoint.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.frame</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:function</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">pc</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">frame</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pc</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/unfbreak </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pc</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eprint </span><span class="s" title="Literal.String">&quot;cleared breakpoint in &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fun</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; at pc=&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">pc</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.next</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Go to the next breakpoint.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">resume </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.fiber</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.nextc</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Go to the next breakpoint, clearing the current breakpoint.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.clear</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.next</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">.step</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Execute the next n instructions.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">forv </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/step </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">.fiber</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">  </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">def- </span><span class="nv" title="Name.Variable">debugger-keys</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">filter </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partial </span><span class="nv" title="Name.Variable">string/has-prefix?</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;.&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keys </span><span class="nv" title="Name.Variable">root-env</span><span class="p" title="Punctuation">)))</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">debugger-keys</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">debugger-env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">root-env </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">root-env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### REPL</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">repl</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Run a repl. The first parameter is an optional function to call to</span>
<span class="s" title="Literal.String">  get a chunk of source code that should return nil for end of file.</span>
<span class="s" title="Literal.String">  The second parameter is a function that is called when a signal is</span>
<span class="s" title="Literal.String">  caught. One can provide an optional environment table to run</span>
<span class="s" title="Literal.String">  the repl in, as well as an optional parser or read function to pass</span>
<span class="s" title="Literal.String">  to `run-context`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chunks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">onsignal</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parser</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">read</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">make-env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">chunks</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">getline</span>
<span class="nb" title="Name.Builtin">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string</span>
<span class="nb" title="Name.Builtin">          </span><span class="s" title="Literal.String">&quot;repl:&quot;</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">((</span><span class="no" title="Name.Constant">:where</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="s" title="Literal.String">&quot;:&quot;</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="no" title="Name.Constant">:state</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:delimiters</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&gt; &quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">run-context </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span>
<span class="w" title="Text.Whitespace">                </span><span class="no" title="Name.Constant">:chunks</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chunks</span>
<span class="w" title="Text.Whitespace">                </span><span class="no" title="Name.Constant">:on-status</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">onsignal</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debugger-on-status </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                </span><span class="no" title="Name.Constant">:parser</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">parser</span>
<span class="w" title="Text.Whitespace">                </span><span class="no" title="Name.Constant">:read</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">read</span>
<span class="w" title="Text.Whitespace">                </span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:repl</span><span class="p" title="Punctuation">}))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Extras</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compwhen </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">ev/go</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">net/close</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;Alias for `ev/close`.&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">stream</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ev/close </span><span class="nv" title="Name.Variable">stream</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">ev/call</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">    Call a function asynchronously.</span>
<span class="s" title="Literal.String">    Returns a fiber that is scheduled to run the function.</span>
<span class="s" title="Literal.String">    ```</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ev/go </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">_call</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">ev/spawn</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Run some code in a new fiber. This is shorthand for `(ev/go (fn [] ;body))`.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ev/go</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">_spawn</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">ev/do-thread</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">``Run some code in a new thread. Suspends the current fiber until the thread is complete, and</span>
<span class="s" title="Literal.String">    evaluates to nil.``</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ev/thread</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">_do-thread</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">ev/spawn-thread</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">``Run some code in a new thread. Like `ev/do-thread`, but returns nil immediately.``</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ev/thread</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">_spawn-thread</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="no" title="Name.Constant">:n</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">ev/with-deadline</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">`Run a body of code with a deadline, such that if the code does not complete before</span>
<span class="s" title="Literal.String">    the deadline is up, it will be canceled.`</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">deadline</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">coro </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ev/deadline</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">deadline</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">resume</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">cancel-all</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">chan</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fibers</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">reason</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fibers</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ev/cancel </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">reason</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">fibers</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/clear </span><span class="nv" title="Name.Variable">fibers</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">repeat </span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ev/take </span><span class="nv" title="Name.Variable">chan</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">wait-for-fibers</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">chan</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fibers</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defer </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cancel</span><span class="nv" title="Name.Variable">-all</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chan</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fibers</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;parent canceled&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">repeat </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">fibers</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">sig</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fiber</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ev/take </span><span class="nv" title="Name.Variable">chan</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="nv" title="Name.Variable">sig</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ok</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">fibers</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fiber</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cancel</span><span class="nv" title="Name.Variable">-all</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">chan</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fibers</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;sibling canceled&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">propagate </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/last-value </span><span class="nv" title="Name.Variable">fiber</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fiber</span><span class="p" title="Punctuation">))))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">ev/gather</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">``</span>
<span class="s" title="Literal.String">    Run a number of fibers in parallel on the event loop, and join when they complete.</span>
<span class="s" title="Literal.String">    Returns the gathered results in an array.</span>
<span class="s" title="Literal.String">    ``</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bodies</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">with-syms </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">chan</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fset</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ftemp</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fset</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">chan</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ev/chan</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@[])</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">seq </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:pairs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">bodies</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">             </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ftemp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ev/go</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">chan</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">put</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fset</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ftemp</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ftemp</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">wait-for-fibers</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">chan</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">fset</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compwhen </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">net/listen</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">net/server</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Start a server asynchronously with `net/listen` and `net/accept-loop`. Returns the new server stream.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">host</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">port</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">handler</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">type</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">net/listen </span><span class="nv" title="Name.Variable">host</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">port</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">type</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">handler</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ev/go </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">net/accept-loop </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">handler</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### FFI Extra</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">delay</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Lazily evaluate a series of expressions. Returns a function that</span>
<span class="s" title="Literal.String">  returns the result of the last expression. Will only evaluate the</span>
<span class="s" title="Literal.String">  body once, and then memoizes the result.&quot;</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">state</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">loaded</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">gensym</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">((</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">state</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">loaded</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">loaded</span>
<span class="w" title="Text.Whitespace">          </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">state</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">loaded</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">state</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">forms</span><span class="p" title="Punctuation">))))))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compwhen </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">ffi/native</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*ffi-context*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; Current native library for ffi/bind and other settings&quot;</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">default-mangle</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/replace-all </span><span class="s" title="Literal.String">&quot;-&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;_&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">ffi/context</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Set the path of the dynamic library to implictly bind, as well</span>
<span class="s" title="Literal.String">     as other global state for ease of creating native bindings.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;opt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">native-path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;named</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">map-symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lazy</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">default </span><span class="nv" title="Name.Variable">map-symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">default-mangle</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lib</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">lazy</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ffi/native </span><span class="nv" title="Name.Variable">native-path</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lazy-lib</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">lazy</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">delay </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ffi/native </span><span class="nv" title="Name.Variable">native-path</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*ffi-context*</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">@{</span><span class="no" title="Name.Constant">:native-path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">native-path</span>
<span class="w" title="Text.Whitespace">              </span><span class="no" title="Name.Constant">:native</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lib</span>
<span class="w" title="Text.Whitespace">              </span><span class="no" title="Name.Constant">:native-lazy</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lazy-lib</span>
<span class="w" title="Text.Whitespace">              </span><span class="no" title="Name.Constant">:lazy</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lazy</span>
<span class="w" title="Text.Whitespace">              </span><span class="no" title="Name.Constant">:map-symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">map-symbols</span><span class="p" title="Punctuation">}))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">ffi/defbind</span>
<span class="w" title="Text.Whitespace">    </span><span class="s" title="Literal.String">&quot;Generate bindings for native functions in a convenient manner.&quot;</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ret-type</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">real-ret-type</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval </span><span class="nv" title="Name.Variable">ret-type</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">meta</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slice </span><span class="nv" title="Name.Variable">body</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">-2</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">arg-pairs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition </span><span class="mf" title="Literal.Number.Float">2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="nv" title="Name.Variable">body</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">formal-args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">arg-pairs</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">type-args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">map </span><span class="mf" title="Literal.Number.Float">1</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">arg-pairs</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">computed-type-args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">type-args</span><span class="p" title="Punctuation">]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">{</span><span class="no" title="Name.Constant">:native</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lib</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:lazy</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lazy</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:native-lazy</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">llib</span>
<span class="w" title="Text.Whitespace">          </span><span class="no" title="Name.Constant">:map-symbols</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">ms</span><span class="p" title="Punctuation">}</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">assert </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*ffi-context*</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;no ffi context found&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">raw-symbol</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">ms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">name</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">make-sig</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ffi/signature </span><span class="no" title="Name.Constant">:default</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">real-ret-type</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">computed-type-args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">make-ptr</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">assert </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">ffi/lookup </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">lazy</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">llib</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lib</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">raw-symbol</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;failed to find ffi symbol &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">raw-symbol</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">lazy</span>
<span class="w" title="Text.Whitespace">      </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">meta</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">formal-args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ffi/call</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">delay </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">make-ptr</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">delay </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">make-sig</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">formal-args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">name</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">meta</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">formal-args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="o" title="Operator">,</span><span class="nv" title="Name.Variable">ffi/call</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">make-ptr</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">make-sig</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">,;</span><span class="nv" title="Name.Variable">formal-args</span><span class="p" title="Punctuation">)))))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Flychecking</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">no-side-effects</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Check if form may have side effects. If returns true, then the src</span>
<span class="s" title="Literal.String">  must not have side effects, such as calling a C function.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple? </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/type </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:brackets</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">all </span><span class="nv" title="Name.Variable">no-side-effects</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array? </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">all </span><span class="nv" title="Name.Variable">no-side-effects</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dictionary? </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">all </span><span class="nv" title="Name.Variable">no-side-effects</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keys </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">         </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">all </span><span class="nv" title="Name.Variable">no-side-effects</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">values </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">is-safe-def</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">no-side-effects</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">last </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">def- </span><span class="nv" title="Name.Variable">safe-forms</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">{</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">defn</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">varfn</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">defn-</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">defmacro</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">defmacro-</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span>
<span class="k k-Constants" title="Keyword.Constants">                  </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-safe-def</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">var</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-safe-def</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">def-</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-safe-def</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">var-</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-safe-def</span>
<span class="w" title="Text.Whitespace">                  </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">defglobal</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-safe-def</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">varglobal</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-safe-def</span><span class="p" title="Punctuation">})</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">def- </span><span class="nv" title="Name.Variable">importers</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">{</span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">import</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">import*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">dofile</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">require</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">})</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">use-2</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">a</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">import* </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="nv" title="Name.Variable">a</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:prefix</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">evaluator</span><span class="p" title="Punctuation">)))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">flycheck-evaluator</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``An evaluator function that is passed to `run-context` that lints (flychecks) code.</span>
<span class="s" title="Literal.String">  This means code will parsed and compiled, macros executed, but the code will not be run.</span>
<span class="s" title="Literal.String">  Used by `flycheck`.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">thunk</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple? </span><span class="nv" title="Name.Variable">source</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">head</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">safe-check</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or</span>
<span class="nb" title="Name.Builtin">        </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">safe-forms</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol? </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/has-prefix? </span><span class="s" title="Literal.String">&quot;define-&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">is-safe-def</span><span class="p" title="Punctuation">))))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cond</span>
<span class="nb" title="Name.Builtin">      </span><span class="c1" title="Comment.Single"># Sometimes safe form</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">function? </span><span class="nv" title="Name.Variable">safe-check</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">safe-check</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">thunk</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># Always safe form</span>
<span class="w" title="Text.Whitespace">      </span><span class="nv" title="Name.Variable">safe-check</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">thunk</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># Use</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">use</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">use</span><span class="mf" title="Literal.Number.Float">-2</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">flycheck-evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/slice </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># Import-like form</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">import</span><span class="nv" title="Name.Variable">ers</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">head</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/sourcemap </span><span class="nv" title="Name.Variable">source</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="nv" title="Name.Variable">newtup</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple/setmap </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">tuple </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">flycheck-evaluator</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">l</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">c</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">((</span><span class="nb" title="Name.Builtin">compile </span><span class="nv" title="Name.Variable">newtup</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">where</span><span class="p" title="Punctuation">))))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">flycheck</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Check a file for errors without running the file. Found errors will be printed to stderr</span>
<span class="s" title="Literal.String">  in the usual format. Macros will still be executed, however, so</span>
<span class="s" title="Literal.String">  arbitrary execution is possible. Other arguments are the same as `dofile`. `path` can also be</span>
<span class="s" title="Literal.String">  a file value such as stdin. Returns nil.``</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;keys</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">kwargs</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">old-modcache</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/clone </span><span class="nv" title="Name.Variable">module/cache</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/clear </span><span class="nv" title="Name.Variable">module/cache</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">try</span>
<span class="nb" title="Name.Builtin">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dofile </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">flycheck-evaluator</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">kvs </span><span class="nv" title="Name.Variable">kwargs</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">([</span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">debug/stacktrace </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/clear </span><span class="nv" title="Name.Variable">module/cache</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">merge-into </span><span class="nv" title="Name.Variable">module/cache</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">old-modcache</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>


<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### CLI Tool Main</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="c1" title="Comment.Single"># conditional compilation for reduced os</span>
<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">def- </span><span class="nv" title="Name.Variable">getenv-alias</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">root-env</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">os/getenv</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:value</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">])))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">run-main</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">subargs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">arg</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">main</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">             </span><span class="nv" title="Name.Variable">main</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:value</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">entry</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ref</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">guard</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:debug</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:ydt</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:y</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">wrap-main</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">main</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">subargs</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/new </span><span class="nv" title="Name.Variable">wrap-main</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">guard</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/can-resume? </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">res</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">resume </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not= </span><span class="no" title="Name.Constant">:dead</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">fiber/status </span><span class="nv" title="Name.Variable">f</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">((</span><span class="nb" title="Name.Builtin">debugger-on-status </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">f</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">res</span><span class="p" title="Punctuation">)))))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*args*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Dynamic bindings that will contain command line arguments at program start.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*executable*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">``Name of the interpreter executable used to execute this program. Corresponds to `argv[0]` in the call to</span>
<span class="s" title="Literal.String">    `int main(int argc, char **argv);`.``</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defdyn </span><span class="nv" title="Name.Variable">*profilepath*</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">&quot;Path to profile file loaded when starting up the repl.&quot;</span><span class="p" title="Punctuation">)</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compwhen </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">os/isatty</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defmacro </span><span class="nv" title="Name.Variable">os/isatty</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>

<span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">cli-main</span>
<span class="w" title="Text.Whitespace">  </span><span class="s" title="Literal.String">`Entrance for the Janet CLI tool. Call this function with the command line</span>
<span class="s" title="Literal.String">  arguments as an array or tuple of strings to invoke the CLI interface.`</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">]</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*args*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">should-repl</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">no-file</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">quiet</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">raw-stdin</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">handleopts</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">exit-on-error</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">colorize</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">debug-flag</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">compile-only</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">warn-level</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">error-level</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">expect-image</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">jp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">env-alias</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;JANET_PATH&quot;</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*syspath*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">jp</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">jprofile</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">env-alias</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;JANET_PROFILE&quot;</span><span class="p" title="Punctuation">)]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*profilepath*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">jprofile</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">colorize</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and</span>
<span class="nb" title="Name.Builtin">                  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">not </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">env-alias</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;NO_COLOR&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/isatty </span><span class="nv" title="Name.Variable">stdout</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">get-lint-level</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">x</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">scan-number </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">keyword </span><span class="nv" title="Name.Variable">x</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Flag handlers</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">handlers</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">{</span><span class="s" title="Literal.String">&quot;h&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;usage: &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*executable*</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;janet&quot;</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; [options] script args...&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span>
<span class="nb" title="Name.Builtin">             </span><span class="s" title="Literal.String">```</span>
<span class="s" title="Literal.String">             Options are:</span>
<span class="s" title="Literal.String">               -h : Show this help</span>
<span class="s" title="Literal.String">               -v : Print the version string</span>
<span class="s" title="Literal.String">               -s : Use raw stdin instead of getline like functionality</span>
<span class="s" title="Literal.String">               -e code : Execute a string of janet</span>
<span class="s" title="Literal.String">               -E code arguments... : Evaluate an expression as a short-fn with arguments</span>
<span class="s" title="Literal.String">               -d : Set the debug flag in the REPL</span>
<span class="s" title="Literal.String">               -r : Enter the REPL after running all scripts</span>
<span class="s" title="Literal.String">               -R : Disables loading profile.janet when JANET_PROFILE is present</span>
<span class="s" title="Literal.String">               -p : Keep on executing if there is a top-level error (persistent)</span>
<span class="s" title="Literal.String">               -q : Hide logo (quiet)</span>
<span class="s" title="Literal.String">               -k : Compile scripts but do not execute (flycheck)</span>
<span class="s" title="Literal.String">               -m syspath : Set system path for loading global modules</span>
<span class="s" title="Literal.String">               -c source output : Compile janet source code into an image</span>
<span class="s" title="Literal.String">               -i : Load the script argument as an image file instead of source code</span>
<span class="s" title="Literal.String">               -n : Disable ANSI color output in the REPL</span>
<span class="s" title="Literal.String">               -N : Enable ANSI color output in the REPL</span>
<span class="s" title="Literal.String">               -l lib : Use a module before processing more arguments</span>
<span class="s" title="Literal.String">               -w level : Set the lint warning level - default is &quot;normal&quot;</span>
<span class="s" title="Literal.String">               -x level : Set the lint error level - default is &quot;none&quot;</span>
<span class="s" title="Literal.String">               -- : Stop handling options</span>
<span class="s" title="Literal.String">             ```</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/exit </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;v&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="nv" title="Name.Variable">janet/version</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;-&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">janet/build</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/exit </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;s&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">raw-stdin</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">should-repl</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;r&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">should-repl</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;p&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">exit-on-error</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;q&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">quiet</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;i&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">expect-image</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;k&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">compile-only</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">exit-on-error</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;n&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">colorize</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;N&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">colorize</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;m&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*syspath*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;c&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">c-switch</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">path</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">e</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dofile </span><span class="nv" title="Name.Variable">path</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">spit </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">make-image </span><span class="nv" title="Name.Variable">e</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">no-file</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="mf" title="Literal.Number.Float">3</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;-&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">handleopts</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;l&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">l-switch</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">import* </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">                    </span><span class="no" title="Name.Constant">:prefix</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">exit-on-error</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;e&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">e-switch</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">no-file</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eval-string </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">           </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;E&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="nv" title="Name.Variable">E-switch</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">no-file</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">subargs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/slice </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">src</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">~</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">short-fn </span><span class="o" title="Operator">,</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parse </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+ </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">E-expression</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">thunk</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">compile </span><span class="nv" title="Name.Variable">src</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">           </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">function? </span><span class="nv" title="Name.Variable">thunk</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">             </span><span class="p" title="Punctuation">((</span><span class="nv" title="Name.Variable">thunk</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">;</span><span class="nv" title="Name.Variable">subargs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">             </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">error </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">thunk</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:error</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">           </span><span class="nv" title="Name.Variable">math/inf</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;d&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">debug-flag</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;w&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">warn-level</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-lint-level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;x&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">error-level</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">-lint-level</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;R&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*profilepath*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)})</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn- </span><span class="nv" title="Name.Variable">dohandler</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">n</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">&amp;</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">handlers</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;unknown flag -&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">n</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">((</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">handlers</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;h&quot;</span><span class="p" title="Punctuation">)))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Process arguments</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">var </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">lenargs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">length </span><span class="nv" title="Name.Variable">args</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">while </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">&lt; </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lenargs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">arg</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">and </span><span class="nv" title="Name.Variable">handleopts</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">= </span><span class="s" title="Literal.String">&quot;-&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">arg</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">+= </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">dohandler</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/slice </span><span class="nv" title="Name.Variable">arg</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">subargs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">array/slice </span><span class="nv" title="Name.Variable">args</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">i</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">no-file</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">expect-image</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">load-image </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slurp </span><span class="nv" title="Name.Variable">arg</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*args*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">subargs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*lint-error*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">error-level</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*lint-warn*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">warn-level</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">debug-flag</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*debug*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*redef*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">run-main</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">subargs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">arg</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">make-env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*args*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">subargs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*lint-error*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">error-level</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*lint-warn*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">warn-level</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">debug-flag</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*debug*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*redef*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">            </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">compile-only</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flycheck </span><span class="nv" title="Name.Variable">arg</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">exit-on-error</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">              </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">                </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dofile </span><span class="nv" title="Name.Variable">arg</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">exit-on-error</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">                </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">run-main</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">subargs</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">arg</span><span class="p" title="Punctuation">)))))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">set </span><span class="nv" title="Name.Variable">i</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lenargs</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="nv" title="Name.Variable">should-repl</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">no-file</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if</span>
<span class="k" title="Keyword">      </span><span class="nv" title="Name.Variable">compile-only</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flycheck </span><span class="nv" title="Name.Variable">stdin</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:stdin</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">exit-on-error</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>
<span class="k" title="Keyword">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">if-not </span><span class="nv" title="Name.Variable">quiet</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;Janet &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">janet/version</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;-&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">janet/build</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/which</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/arch</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">os/compiler</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; - &#39;(doc)&#39; for help&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">flush</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">getprompt</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">line</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/where </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string </span><span class="s" title="Literal.String">&quot;repl:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;:&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">parser/state </span><span class="nv" title="Name.Variable">p</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:delimiters</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&gt; &quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">getstdin</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">prompt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">_</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/write </span><span class="nv" title="Name.Variable">stdout</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">prompt</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/flush </span><span class="nv" title="Name.Variable">stdout</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">file/read </span><span class="nv" title="Name.Variable">stdin</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:line</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">make-env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">profile.janet</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dyn </span><span class="nv" title="Name.Variable">*profilepath*</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">new-env</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">dofile </span><span class="nv" title="Name.Variable">profile.janet</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:exit</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">merge-module </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">new-env</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">false</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="nv" title="Name.Variable">debug-flag</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*debug*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">*redef*</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">getter</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">raw-stdin</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">getstdin</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">getline</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">getchunk</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">          </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">ter</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get</span><span class="nv" title="Name.Variable">prompt</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">p</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">buf</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*pretty-format*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">colorize</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;%.20Q&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;%.20q&quot;</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*err-color*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">colorize</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*doc-color*</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="nv" title="Name.Variable">colorize</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">true</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*lint-error*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">error-level</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">setdyn </span><span class="nv" title="Name.Variable">*lint-warn*</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">error-level</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">repl </span><span class="nv" title="Name.Variable">getchunk</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil </span><span class="nv" title="Name.Variable">env</span><span class="p" title="Punctuation">)))))</span>

<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">### Bootstrap</span>
<span class="c1" title="Comment.Single">###</span>
<span class="c1" title="Comment.Single">###</span>

<span class="p" title="Punctuation">(</span><span class="k" title="Keyword">do</span>

<span class="k" title="Keyword">  </span><span class="c1" title="Comment.Single"># Modify root-env to remove private symbols and</span>
<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># flatten nested tables.</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">pairs </span><span class="nv" title="Name.Variable">root-env</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">         </span><span class="no" title="Name.Constant">:when</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">symbol? </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">flat</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table/proto-flatten </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">boot/config</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:no-docstrings</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">flat</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:doc</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">boot/config</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:no-sourcemaps</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">flat</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source-map</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="c1" title="Comment.Single"># Fix directory separators on windows to make image identical between windows and non-windows</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">when-let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">sm</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">get </span><span class="nv" title="Name.Variable">flat</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source-map</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">flat</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:source-map</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">[(</span><span class="nb" title="Name.Builtin">string/replace-all </span><span class="s" title="Literal.String">&quot;\\&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;/&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">sm</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">0</span><span class="p" title="Punctuation">))</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">sm</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">1</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">sm</span><span class="w" title="Text.Whitespace"> </span><span class="mf" title="Literal.Number.Float">2</span><span class="p" title="Punctuation">)]))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:private</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">root-env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">root-env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">flat</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">root-env</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">boot/config</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">root-env</span><span class="w" title="Text.Whitespace"> </span><span class="o" title="Operator">&#39;</span><span class="nv" title="Name.Variable">boot/args</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Build dictionary for loading images</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">load-dict</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">env-lookup </span><span class="nv" title="Name.Variable">root-env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">pairs </span><span class="nv" title="Name.Variable">load-dict</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">number? </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">load-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="k k-Constants" title="Keyword.Constants">nil</span><span class="p" title="Punctuation">)))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">merge-into </span><span class="nv" title="Name.Variable">load-image-dict</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">load-dict</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">image</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">let </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">env-pairs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">pairs </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">env-lookup </span><span class="nv" title="Name.Variable">root-env</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">essential-pairs</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">filter </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">fn </span><span class="p" title="Punctuation">[[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]]</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">or </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">cfunction? </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">abstract? </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)))</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">env-pairs</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">lookup</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">table </span><span class="o" title="Operator">;</span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">mapcat </span><span class="nv" title="Name.Variable">identity</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">essential-pairs</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">          </span><span class="nv" title="Name.Variable">reverse-lookup</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">invert </span><span class="nv" title="Name.Variable">lookup</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">      </span><span class="c1" title="Comment.Single"># Check no duplicate values</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">temp</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">@{})</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">eachp </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">k</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">]</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">lookup</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">if </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">in </span><span class="nv" title="Name.Variable">temp</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">)</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">errorf </span><span class="s" title="Literal.String">&quot;duplicate value: %v&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">        </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">put </span><span class="nv" title="Name.Variable">temp</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">v</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">k</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">marshal </span><span class="nv" title="Name.Variable">root-env</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">reverse-lookup</span><span class="p" title="Punctuation">)))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Create amalgamation</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">feature-header</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;src/core/features.h&quot;</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">local-headers</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;src/core/state.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/util.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/gc.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/vector.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/fiber.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/regalloc.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/compile.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/emit.h&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/symcache.h&quot;</span><span class="p" title="Punctuation">])</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">core-sources</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="s" title="Literal.String">&quot;src/core/abstract.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/array.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/asm.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/buffer.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/bytecode.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/capi.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/cfuns.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/compile.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/corelib.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/debug.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/emit.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/ev.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/ffi.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/fiber.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/gc.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/inttypes.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/io.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/marsh.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/math.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/net.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/os.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/parse.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/peg.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/pp.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/regalloc.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/run.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/specials.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/state.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/string.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/strtod.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/struct.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/symcache.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/table.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/tuple.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/util.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/value.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/vector.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/vm.c&quot;</span>
<span class="w" title="Text.Whitespace">     </span><span class="s" title="Literal.String">&quot;src/core/wrap.c&quot;</span><span class="p" title="Punctuation">])</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Print janet.c to stdout</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;/* Amalgamated build - DO NOT EDIT */&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;/* Generated from janet version &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">janet/version</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;-&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">janet/build</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; */&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;#define JANET_BUILD \&quot;&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">janet/build</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\&quot;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">```#define JANET_AMALG```</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">defn </span><span class="nv" title="Name.Variable">do-one-file</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">fname</span><span class="p" title="Punctuation">]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">unless </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">has-value? </span><span class="nv" title="Name.Variable">boot/args</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;image-only&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;\n/* &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fname</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot; */&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;#line 0 \&quot;&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">fname</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;\&quot;\n&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="k" title="Keyword">def </span><span class="nv" title="Name.Variable">source</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">slurp </span><span class="nv" title="Name.Variable">fname</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">string/replace-all </span><span class="s" title="Literal.String">&quot;\r&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="s" title="Literal.String">&quot;&quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">source</span><span class="p" title="Punctuation">))))</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-one-file</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">feature-header</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">```#include &quot;janet.h&quot;```</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">h</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">local-headers</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-one-file</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">h</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># windows.h should not be included in any of the external or internal headers - only in .c files.</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;/* Windows work around - winsock2 must be included before windows.h, especially in amalgamated build */&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;#if defined(JANET_WINDOWS) &amp;&amp; defined(JANET_NET)&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;#include &lt;winsock2.h&gt;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;#endif&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="p" title="Punctuation">)</span>

<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">s</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">core-sources</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nv" title="Name.Variable">do-one-file</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">s</span><span class="p" title="Punctuation">))</span>

<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># Create C source file that contains images a uint8_t buffer. This</span>
<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># can be compiled and linked statically into the main janet library</span>
<span class="w" title="Text.Whitespace">  </span><span class="c1" title="Comment.Single"># and example client.</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;static const unsigned char janet_core_image_bytes[] = {&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">loop </span><span class="p" title="Punctuation">[</span><span class="nv" title="Name.Variable">line</span><span class="w" title="Text.Whitespace"> </span><span class="no" title="Name.Constant">:in</span><span class="w" title="Text.Whitespace"> </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">partition </span><span class="mf" title="Literal.Number.Float">16</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">image</span><span class="p" title="Punctuation">)]</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">prin </span><span class="s" title="Literal.String">&quot;  &quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">each </span><span class="nv" title="Name.Variable">b</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">line</span>
<span class="w" title="Text.Whitespace">      </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">prinf </span><span class="s" title="Literal.String">&quot;0x%.2X, &quot;</span><span class="w" title="Text.Whitespace"> </span><span class="nv" title="Name.Variable">b</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">    </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print</span><span class="p" title="Punctuation">))</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;  0\n};\n&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;const unsigned char *janet_core_image = janet_core_image_bytes;&quot;</span><span class="p" title="Punctuation">)</span>
<span class="w" title="Text.Whitespace">  </span><span class="p" title="Punctuation">(</span><span class="nb" title="Name.Builtin">print </span><span class="s" title="Literal.String">&quot;size_t janet_core_image_size = sizeof(janet_core_image_bytes);&quot;</span><span class="p" title="Punctuation">))</span>
</pre></div>
</body>
</html>
</body>
</html>